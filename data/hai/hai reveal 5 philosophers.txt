# Copyright (c) 2020 MasterOfGrey
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.

mission "Hai Reveal [B01] Information Blackout"
	landing
	name "<NM-707>"
	description "<DS-2715>"
	source "Sunracer"
	clearance
	to offer
		has "Hai Reveal [A13] A New Elder: done"
	to complete
		never
	on offer
		event "hai and human ships at wormhole"
		conversation
			`<CN-13803>`
			`<CN-13804>`
				accept


# Ensure there are some impressive fleets at each system.
mission "Hai Reveal [B01-A] The Blockade Goes Up"
	landing
	invisible
	source "Mountaintop"
	to offer
		has "Hai Reveal [A13] A New Elder: done"
	to complete
		never
	npc
		government "Republic"
		system "Rigel"
		personality heroic opportunistic staying
		fleet
			names "republic capital"
			fighters
				names "syndicate fighter"
			variant
				"Carrier (Mark II)" 2
				"Cruiser (Mark II)" 6
				"Combat Drone" 36
				"Lance (Gatling)" 8
				"Frigate (Mark II)" 12
				"Rainmaker (Mark II)" 8
				"Rainmaker (Mark II Old Weapons)" 8
	npc
		government "Republic"
		system "Nihal"
		personality heroic opportunistic staying
		fleet
			names "republic capital"
			fighters
				names "syndicate fighter"
			variant
				"Carrier (Mark II)" 2
				"Cruiser (Mark II)" 6
				"Combat Drone" 36
				"Lance (Gatling)" 8
				"Frigate (Mark II)" 12
				"Rainmaker (Mark II)" 8
				"Rainmaker (Mark II Old Weapons)" 8
	npc
		government "Syndicate"
		system "Mirfak"
		personality heroic staying
		fleet "Large Syndicate" 8
	npc
		government "Syndicate"
		system "Zaurak"
		personality heroic staying
		fleet "Large Syndicate" 8


# The fact that you have to actively go to the spaceport to proc this mission is intentional. It allows the player to take a pause to reorganize themselves if they need to, B01 stays active as a reminder.
# The fight in this mission is very large, but it's also a complete roflstomp. The pirates are outnumbered 2-1, and out-gunned significantly worse than that.
# You as the player have one job: make sure everyone jumps in together, and don't die. During the first campaign it was really important the fights were all balanced for you to be able to tip the balance.
# THIS mission is designed to give you a spectacle. A little visual demonstration of what a real battle could potentially look and feel like with low stakes for you. It's a visual feast, not a challenge.
mission "Hai Reveal [B02] Join the Fleet"
	autosave
	name "<NM-708>"
	description "<DS-2716>"
	deadline 9
	# The minimum journey time is 7
	source "Sunracer"
	waypoint "Moktar"
	destination "Stormhold"
	clearance
	to offer
		has "Hai Reveal [A14] A Time of Trouble: done"
	on offer
		conversation
			`<CN-13805>`
			`<CN-13806>`
			`<CN-13807>`
			choice
				`<CN-13808>`
				`<CN-13809>`
					goto prepare
			`<CN-13810>`
			`<CN-13811>`
			`<CN-13812>`
				accept
			label prepare
			`<CN-13813>`
				defer
	npc
		government "Syndicate"
		personality escort coward opportunistic vindictive
		fleet
			names "syndicate capital"
			variant
				"Protector" 2
				"Vanguard" 3
				"Vanguard (Particle)" 3
				"Splinter (Flamethrower Blaster)" 4
		# This special security force has acquired outfits in the post-war condition that were surplus or black market to upgrade their Splinters.
		# However, they haven't had the time to refit and test out new options for their Protectors or Vanguards.
	# Fleets start at Rajak instead of Ultima Thule to ensure they
	# have enough fuel to reach Stormhold.
	npc accompany
		government "Republic"
		system "Rajak"
		personality escort heroic opportunistic waiting
		fleet "Human Wormhole Guards" 20
	npc accompany
		government "Hai"
		system "Rajak"
		personality escort heroic opportunistic waiting
		fleet "Hai Wormhole Guards" 20
	npc accompany
		government "Hai (Friendly Unfettered)"
		system "Rajak"
		personality escort heroic opportunistic vindictive waiting
		fleet "Large Unfettered" 7
	# Guard fleets are 1 ship each. Unfet are 2.7 on average. Total Fleet Size is roughly 57 + 10 Syndicate.

	npc kill
		government "Pirate"
		personality staying waiting heroic opportunistic vindictive
		system "Alcyone"
		fleet "Marauder fleet IX" 3
	npc kill
		government "Pirate"
		personality staying waiting heroic opportunistic vindictive
		system "Alcyone"
		fleet "Marauder fleet X" 4
	# IX is 4 decent ships each, X is 6 ships but 2 are weak each. Total Fleet Size is roughly 28 + some chaff (~8).
	on fail
		dialog `<DL-593>`
	on accept
		fail "Hai Reveal [B01] Information Blackout"
		fail "Hai Reveal [A11-B] Permanent Fleets"
	on enter "Moktar"
		dialog `<DL-594>`
	on enter "Oblate"
		dialog `<DL-595>`
	on complete
		event "stormhold suppressed"
	on visit
		dialog
			`<CN-13814>`

event "stormhold suppressed"
	# Update pirate and anti-pirate spawns in Alcyone - Hai ships stay landed so they don't travel into Syndi space. Korath ships keep away.
	system "Alcyone"
		remove fleet "Small Core Pirates" # 400
		remove fleet "Large Core Pirates"# 600
		remove fleet "Korath Large Raid" # 50000
		add fleet "Human Wormhole Guards" 500


mission "Hai Reveal [B02-A] The Blockade Goes Up"
	landing
	invisible
	source "Stormhold"
	to offer
		has "Hai Reveal [B02] Join the Fleet: done"
	to complete
		never
	npc
		government "Syndicate"
		system "Alcyone"
		personality staying waiting opportunistic vindictive
		fleet
			names "syndicate capital"
			variant
				"Protector" 2
				"Vanguard" 3
				"Vanguard (Particle)" 3
				"Splinter (Flamethrower Blaster)" 4
		# This special security force remains local to represent Syndicate interests and security integrity.


mission "Hai Reveal [B02-S] Republic Intelligence Stalkers"
	landing
	invisible
	source "Stormhold"
	to offer
		has "Hai Reveal [B02] Join the Fleet: done"
	to complete
		has "Hai Reveal [B04] The Riddle: done"
	npc
		government "Republic Intelligence"
		system "Alcyone"
		personality launching mute marked
		ship "Frigate (Republic Intelligence)" "R.I.S. Adrasteia"


mission "Hai Reveal [B03] Contact Giti"
	landing
	name "<NM-709>"
	description "<DS-2717>"
	source "Stormhold"
	destination "Canyon"
	clearance
	to offer
		has "Hai Reveal [B02] Join the Fleet: done"
	on offer
		conversation
			`<CN-13815>`
			`<CN-13816>`
			`<CN-13817>`
			choice
				`<CN-13818>`
					goto "cede to danforth"
				`<CN-13819>`
			action
				set "HR: Allied Leader"
			`<CN-13820>`
			label briefing
			choice
				`<CN-13821>`
					goto operation
					to display
						not "Hai Reveal [B03] Contact Giti: label operation"
				`<CN-13822>`
					goto disinformation
					to display
						not "Hai Reveal [B03] Contact Giti: label disinformation"
				`<CN-13823>`
					goto squirrels
					to display
						has "Hai Reveal [B03] Contact Giti: label operation"
						not "Hai Reveal [B03] Contact Giti: label squirrels"
				`<CN-13824>`
					goto honored
					to display
						has "Hai Reveal [B03] Contact Giti: label operation"
						has "Hai Reveal [B03] Contact Giti: label disinformation"
						has "Hai Reveal [B03] Contact Giti: label squirrels"
				`<CN-13825>`
					goto offended
					to display
						has "Hai Reveal [B03] Contact Giti: label operation"
						has "Hai Reveal [B03] Contact Giti: label disinformation"
						has "Hai Reveal [B03] Contact Giti: label squirrels"

			label operation
			action
				set "Hai Reveal [B03] Contact Giti: label operation"
			`<CN-13826>`
			`<CN-13827>`
			`<CN-13828>`
				goto briefing
			label disinformation
			action
				set "Hai Reveal [B03] Contact Giti: label disinformation"
			`<CN-13829>`
			`<CN-13830>`
				goto briefing
			label squirrels
			action
				set "Hai Reveal [B03] Contact Giti: label squirrels"
			`<CN-13831>`
			`<CN-13832>`
			`<CN-13833>`
				goto briefing

			label "cede to danforth"
			action
				set "HR: Allied Supporter"
			`<CN-13834>`
			`<CN-13827>`
			`<CN-13828>`
			`<CN-13835>`
			`<CN-13830>`
			`<CN-13836>`
			`<CN-13833>`
			`<CN-13837>`
			choice
				`<CN-13838>`
					goto honored
				`<CN-13839>`
					goto humble
				`<CN-13840>`

			label offended
			`<CN-13841>`
				goto done
			label humble
			`<CN-13842>`
				goto done
			label honored
			`<CN-13843>`
			label done
			`<CN-13844>`
			`<CN-13845>`
			choice
				`<CN-13846>`
					goto whazzit
				`<CN-13847>`
			`<CN-13848>`
				goto gossip
			label whazzit
			`<CN-13849>`
			label gossip
			`<CN-13850>`
			`<CN-13851>`
			choice
				`<CN-13852>`
					goto giti
				`<CN-13853>`
			`<CN-13854>`
				goto end
			label giti
			`<CN-13855>`
			`<CN-13856>`
			label end
			`<CN-13857>`
			`<CN-13858>`
				accept




mission "Hai Reveal [B04] The Riddle"
	landing
	name "<NM-710>"
	description `<DS-2718>`
	source "Canyon"
	destination "Ada"
	to offer
		has "Hai Reveal [B03] Contact Giti: done"
	on offer
		event "reveal devil-hide"
		conversation
			`<CN-13859>`
			choice
				`<CN-13860>`
				`<CN-13861>`
			`<CN-13862>`
			`<CN-13863>`
			choice
				`<CN-13864>`
				`<CN-13865>`
			`<CN-13866>`
			`<CN-13867>`
			choice
				`<CN-13868>`
				`<CN-13869>`
				`<CN-13870>`
			`<CN-13871>`
			`<CN-13872>`
				accept



mission "Hai Reveal [B05] Seek Elenchus"
	landing
	name "<NM-711>"
	description `<DS-2719>`
	source "Canyon"
	destination "Elenchus"
	to offer
		has "Hai Reveal [B03] Contact Giti: done"
	on offer
		event "reveal devil-hide"


event "reveal devil-hide"
	system "Devil-Hide"
		remove hidden



mission "Hai Reveal [B06] Lovelace Analysis"
	landing
	name "<NM-712>"
	description `<DS-2720>`
	source Ada
	destination Earth
	clearance
	to offer
		has "Hai Reveal [B04] The Riddle: done"
	to complete
		has "Hai Reveal [B07-1] Boarded Smuggler: offered"
		not "Hai Reveal [B07-1] Boarded Smuggler: active"
	on visit
		dialog `<DL-596>`
	on offer
		event "devil-run smugglers visible"
		log "People" "Goraz Zoltof" `<LG-408>`
		log "Factions" "Smugglers" `<LG-409>`
		log `<LG-410>`
		conversation
			`<CN-13873>`
			`<CN-13874>`
			choice
				`<CN-13875>`
					goto lab
				`<CN-13876>`
					goto lead
				`<CN-13877>`
			`<CN-13878>`
			`<CN-13879>`
			`<CN-13880>`
				goto lab
			label lead
			`<CN-13881>`
			label lab
			`<CN-13882>`
			`<CN-13883>`
			choice
				`<CN-13884>`
				`<CN-13885>`
			`<CN-13886>`
			`<CN-13887>`
			`<CN-13888>`
			choice
				`<CN-13889>`
					goto skip
				`<CN-13890>`
			`<CN-13891>`
			`<CN-13892>`
				goto wait
			label skip
			`<CN-13893>`
			`<CN-13894>`
			label wait
			`<CN-13895>`
			choice
				`<CN-13896>`
				`<CN-13897>`
			`<CN-13898>`
			choice
				`<CN-13899>`
				`<CN-13900>`
			`<CN-13901>`
			`<CN-13902>`
			`<CN-13903>`
			`<CN-13904>`
				accept

event "devil-run smugglers visible"

	# Route to Almaaz (and nearby systems)
	system "Rigel"
		add fleet "Smuggler (Hai Traffickers)" 5000
	system "Alnitak"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Saiph"
		add fleet "Smuggler (Hai Traffickers)" 10000
	system "Betelgeuse"
		add fleet "Smuggler (Hai Traffickers)" 10000
	system "Mintaka"
		add fleet "Smuggler (Hai Traffickers)" 5000
	system "Gorvi"
		add fleet "Smuggler (Hai Traffickers)" 5000
	system "Tortor"
		add fleet "Smuggler (Hai Traffickers)" 5000
	system "Unagi"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Hatysa"
		add fleet "Smuggler (Hai Traffickers)" 5000
	
	# Route to Almach
	system "Zaurak"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Sheratan"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Ruchbah"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Alpheratz"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Al Dhanab"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Achernar"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Mirach"
		add fleet "Smuggler (Hai Traffickers)" 7000
	system "Schedar"
		add fleet "Smuggler (Hai Traffickers)" 3500
	
	# Staging areas for transfers
	system "Alcyone"
		add fleet "Smuggler (Hai Traffickers)" 2500
	system "Almaaz"
		add fleet "Smuggler (Hai Traffickers)" 2500
	system "Arneb"
		add fleet "Smuggler (Hai Traffickers)" 2500
	system "Alnilam"
		add fleet "Smuggler (Hai Traffickers)" 2500

	# Final holding area before Devil-Run
	system "Almach"
		add fleet "Smuggler (Hai Traffickers)" 1000
	

fleet "Smuggler (Hai Traffickers)"
	government "Smuggler (Hai Trafficker)"
	names "civilian"
	cargo 0
	personality timid
	variant 7
		"Blackbird (Hai Trafficker)"
	variant 7
		"Mule (Hai Trafficker)"
	variant 7
		"Freighter (Hai Trafficker)"
	variant 5
		"Clipper (Hai Trafficker)"
	variant 5
		"Corvette (Hai Trafficker)"
	variant 3
		"Bounder (Hai Trafficker)"
	variant 3
		"Star Queen (Hai Trafficker)"


mission "Hai Reveal [B07-1] Boarded Smuggler"
	name "<NM-713>"
	description "<DS-2721>"
	boarding
	destination Earth
	clearance
	to offer
		has "Hai Reveal [B06] Lovelace Analysis: active"
	source
		government "Smuggler (Hai Trafficker)"
	on offer
		log `<LG-411>`
		conversation
			`<CN-13905>`
			choice
				`<CN-13906>`
				`<CN-13907>`
			`<CN-13908>`
			`<CN-13909>`
			`<CN-13910>`
				launch
	npc
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "pirate explosive" 3


# Later smugglers have a mix of info vs. none.
mission "Hai Reveal [B07-2] Smuggler Ambush"
	invisible
	boarding
	repeat
	destination Earth
	deadline 1
	to offer
		has "Hai Reveal [B07-1] Boarded Smuggler: offered"
		has "Hai Reveal [B06] Lovelace Analysis: active"
	source
		government "Smuggler (Hai Trafficker)"
	on offer
		conversation
			branch steradians                           # 1:10 chance of steradians
				random < 10
			branch victim                               # 2:10 chance of victim w/o steradians
				random < 22
			# Smuggler was smuggling something else.    # 7:10 chance of just cargo
			`<CN-13911>`
				launch
			label steradians
			# Victim read the navigation logs on an Elenchus-bound ship.
			`<CN-13912>`
				launch
			label victim
			# Victim did not read the navigation logs, or was en-route to a holding area instead of Elenchus.
			`<CN-13913>`
				launch
	npc kill
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "pirate explosive" 2


mission "Hai Reveal [B07-3] Smuggler Cleanup"
	invisible
	to offer
		has "Hai Reveal [B06] Lovelace Analysis: active"
		has "Hai Reveal [B08] Syndicate Internal Affairs: offered"
	on offer
		fail "Hai Reveal [B06] Lovelace Analysis"



# This is the end of learning how the wormholes work.
mission "Hai Reveal [B08] Syndicate Internal Affairs"
	autosave
	landing
	name "<NM-714>"
	description "<DS-2722>"
	deadline
	source "Earth"
	destination "Hephaestus"
	clearance
	passengers 1
	to offer
		has "Hai Reveal [B07-1] Boarded Smuggler: done"
	on offer
		fail "Hai Reveal [B02-S] Republic Intelligence Stalkers"
		log `<LG-412>`
		log "Minor People" `Agent Horst Kopkow` `<LG-413>`
		log "Factions" "Republic Intelligence" `<LG-414>`
		conversation
			`<CN-13914>`
			`<CN-13915>`
			choice
				`<CN-13916>`
				`<CN-13917>`
			`<CN-13918>`
			`<CN-13919>`
			`<CN-13920>`
			choice
				`<CN-678>`
					goto who
				`<CN-13921>`
					goto private
				`<CN-13922>`
					goto die
			label private
			action
				set "Hai Reveal [B08] Syndicate Internal Affairs: private convo"
			`<CN-13923>`
				goto encounters
			label who
			`<CN-13924>`
			label encounters
			`<CN-13925>`
			choice
				`<CN-13926>`
				`<CN-13927>`
					goto humor
					to display
						has "Hai Reveal [B08] Syndicate Internal Affairs: private convo"
				`<CN-13115>`
					goto uncomplaining
			`<CN-13928>`
				goto uncomplaining
			label humor
			`<CN-13929>`
			label uncomplaining
			`<CN-13930>`
			`<CN-13931>`
			choice
				`<CN-13932>`
				`<CN-13933>`
					accept
				`<CN-238>`
					accept
			`<CN-13934>`
			choice
				`<CN-13935>`
				`<CN-9770>`
					accept
				`<CN-13922>`
					goto die
			`<CN-13936>`
				accept
			label die
			`<CN-13937>`
				die
	on fail
		"reputation: Republic" <?= -100
		"reputation: Syndicate" <?= -100
		dialog `<DL-597>`



mission "Hai Reveal [B09] Scanning Devil-Hide"
	landing
	name "<NM-715>"
	description "<DS-2723>"
	source "Hephaestus"
	waypoint "Devil-Run"
	waypoint "Devil-Hide"
	passengers 1
	cargo "advanced scanning equipment" 7
	blocked `<BL-59>`
	on visit
		dialog `<DL-598>`
	to offer
		has "Hai Reveal [B08] Syndicate Internal Affairs: done"
	on offer
		event "reveal devil-run"
		log "People" "Stephen Moray" `<LG-415>`
		log `<LG-416>`
		conversation
			`<CN-13938>`
			`<CN-13939>`
			choice
				`<CN-13940>`
					goto about
				`<CN-13941>`
			`<CN-13942>`
			label about
			`<CN-13943>`
			`<CN-13944>`
			`<CN-13945>`
			`<CN-13946>`
			choice
				`<CN-13947>`
				`<CN-13948>`
				`<CN-13949>`
			`<CN-13950>`
			`<CN-13951>`
			choice
				`<CN-13952>`
					goto mission
				`<CN-13953>`
			action
				set "syndicate learns of alien tech anyway"
			`<CN-13954>`
			label mission
			`<CN-13955>`
			`<CN-13956>`
			`<CN-13957>`
				accept
	on enter "Devil-Run"
		conversation
			`<CN-13958>`
			`<CN-13959>`
	on enter "Devil-Hide"
		log `<LG-417>`
		conversation
			`<CN-13960>`
			label scan
			choice
				`<CN-13961>`
					goto moon
					to display
						not "Hai Reveal [B09] Scanning Devil-Hide: label moon"
				`<CN-13962>`
					goto planet
					to display
						not "Hai Reveal [B09] Scanning Devil-Hide: label planet"
				`<CN-13963>`
					goto leave
					to display
						has "Hai Reveal [B09] Scanning Devil-Hide: label moon"
			label planet
			action
				set "Hai Reveal [B09] Scanning Devil-Hide: label planet"
			`<CN-13964>`
			`<CN-13965>`
			`<CN-13966>`
				goto scan
			label moon
			action
				set "Hai Reveal [B09] Scanning Devil-Hide: label moon"
			`<CN-13967>`
			`<CN-13968>`
			`<CN-13969>`
			`<CN-13970>`
				goto scan
			label leave
			`<CN-13971>`
	on complete
		payment 775000
	npc
		government "Pirate (Devil-Run Gang)"
		system "Devil-Hide"
		fleet "Devil-Run Warships" 2
		personality nemesis harvests plunders disables



event "reveal devil-run"
	system "Devil-Run"
		remove hidden



mission "Hai Reveal [B10] Report to Teeneep"
	landing
	name "<NM-716>"
	description "<DS-2724>"
	source "Hephaestus"
	destination "Stormhold"
	clearance
	to offer
		has "Hai Reveal [B09] Scanning Devil-Hide: done"
	on offer
		log `<LG-418>`
		conversation
			`<CN-13972>`
			`<CN-13973>`
				accept



mission "Hai Reveal [B11] Moving Together"
	landing
	name "<NM-717>"
	description "<DS-2725>"
	source "Stormhold"
	destination "Foundry"
	clearance
	to offer
		has "Hai Reveal [B10] Report to Teeneep: done"
	on offer
		conversation
			`<CN-13974>`
			`<CN-13975>`
			label briefing
			choice
				`<CN-13976>`
					goto introductions
					to display
						not "Hai Reveal [B11] Moving Together: label introductions"
				`<CN-13977>`
					goto smuggling
					to display
						not "Hai Reveal [B11] Moving Together: label smuggling"
				`<CN-13978>`
					goto dealt
					to display
						has "Hai Reveal [B11] Moving Together: label smuggling"
						not "Hai Reveal [B11] Moving Together: label dealt"
				`<CN-13979>`
					goto hai
					to display
						has "Hai Reveal [B11] Moving Together: label smuggling"
						not "Hai Reveal [B11] Moving Together: label hai"
				`<CN-13980>`
					goto secret
					to display
						not "Hai Reveal [B11] Moving Together: label secret"
				`<CN-13981>`
					goto elenchus
					to display
						not "Hai Reveal [B11] Moving Together: label elenchus"
				`<CN-13982>`
					goto penetration
					to display
						has "Hai Reveal [B11] Moving Together: label elenchus"
						not "Hai Reveal [B11] Moving Together: label penetration"
				`<CN-13983>`
					goto solution
			label smuggling
			action
				set "Hai Reveal [B11] Moving Together: label smuggling"
			`<CN-13984>`
			`<CN-13985>`
				goto briefing
			label dealt
			action
				set "Hai Reveal [B11] Moving Together: label dealt"
			`<CN-13986>`
				goto briefing
			label hai
			action
				set "Hai Reveal [B11] Moving Together: label hai"
			`<CN-13987>`
				goto briefing
			label introductions
			action
				set "Hai Reveal [B11] Moving Together: label introductions"
			`<CN-13988>`
			`<CN-13989>`
			`<CN-13990>`
			`<CN-13991>`
			`<CN-13992>`
				goto briefing
			label secret
			action
				set "Hai Reveal [B11] Moving Together: label secret"
			`<CN-13993>`
			`<CN-13994>`
				goto briefing
			label elenchus
			action
				set "Hai Reveal [B11] Moving Together: label elenchus"
			`<CN-13995>`
			choice
				`<CN-13996>`
				`<CN-13997>`
					goto briefing
			`<CN-13998>`
				goto briefing

			label penetration
			action
				set "Hai Reveal [B11] Moving Together: label penetration"
			`<CN-13999>`
			`<CN-14000>`
			`<CN-14001>`
				goto briefing

			label solution
			`<CN-14002>`
			# One crack team of people from all over working together.
			# Alondo did this as a backup after his experience being briefly trapped on Hai-home.
			`<CN-14003>`
			`<CN-14004>`
			`<CN-14005>`
			`<CN-14006>`
				accept
# Everyone has to make it safely to Foundry, even if they don't all make it home from Elenchus.
	npc save accompany
		government "Hai (Wormhole Access)"
		personality timid escort opportunistic
		ship "Centipede (Teeneep Jump)" "Teeneep's Ship"
	npc save accompany
		government "Hai (Friendly Unfettered)"
		personality escort heroic opportunistic vindictive
		ship "Emperor Beetle" "Kratos"
	npc save accompany
		government "Hai (Friendly Unfettered)"
		personality escort heroic opportunistic vindictive
		fleet
			names "hai"
			variant
				"Shield Beetle (Particle Jump)"
				"Shield Beetle (Plasma Blaster Jump)"
	npc save accompany
		government "Navy (Oathkeeper)"
		personality escort heroic opportunistic
		ship "Cruiser (Jump Plasma Anti-Missile)" "N.S. Peacemaker"
	on complete
		payment 600000
		dialog `<DL-599>`
	on visit
		dialog `<DL-600>`



# Ambassadorial Centipede designed to fly deep into hostile space if necessary:
ship "Centipede" "Centipede (Teeneep Jump)"
	# Add some ambassadorial staff:
	add attributes
		"required crew" 50
	outfits
		"Catalytic Ramscoop"
		"Jump Drive"
		"Chameleon Anti-Missile" 3
		"Quantum Keystone"
		"Outfits Expansion"
		`<CN-7912>`
		"Hai Diamond Regenerator"
		"Hai Corundum Regenerator"
		"Hai Chasm Batteries"
		"Liquid Nitrogen Cooler"
		"Boulder Reactor"
		Brig
		"Fuel Pod" 2
		Supercapacitor
		"A370 Atomic Thruster"
		"Pulse Rifle" 131



mission "Hai Reveal [B12] Devil-Hide Battle"
	autosave
	landing
	name "<NM-718>"
	description "<DS-2726>"
	source "Foundry"
	destination "Elenchus"
	to offer
		has "Hai Reveal [B11] Moving Together: done"
	on offer
		conversation
			`<CN-14007>`
			`<CN-14008>`
			label kopkow
			choice
				`<CN-14009>`
					goto maintain
				`<CN-14010>`
					goto "give up"
				`<CN-14011>`
					goto working
					to display
						not "Hai Reveal [B12] Devil-Hide Battle: working"
			label working
			action
				set "Hai Reveal [B12] Devil-Hide Battle: working"
			`<CN-14012>`
				goto kopkow
			label "give up"
			`<CN-14013>`
				goto explain
			label maintain
			`<CN-14014>`
			label explain
			`<CN-14015>`
			`<CN-14016>`
			`<CN-14017>`
			choice
				`<CN-14018>`
					goto control
				`<CN-14019>`
			`<CN-14020>`
				goto leave
			label control
			`<CN-14021>`
			label leave
			`<CN-14022>`
			`<CN-14023>`
			choice
				`<CN-14024>`
					goto how
				`<CN-14025>`
			`<CN-14026>`
			`<CN-14027>`
			action
				set "Choot'k: ain't"
			label how
			`<CN-14028>`
			`<CN-14029>`
			choice
				`<CN-14030>`
					goto done
				`<CN-14031>`
			`<CN-14032>`
			choice
				`<CN-14030>`
					goto done
				`<CN-14033>`
			`<CN-14034>`
			label done
			`<CN-14035>`
				accept
	on accept
		event "elenchus can be dominated"
	on fail
		fail "Hai Reveal [B12-A] Devil-Hide Fleet"
	on decline
		fail "Hai Reveal [B12-A] Devil-Hide Fleet"
	on visit
		conversation
			`<CN-14036>`
	on enter
		dialog `<DL-601>`
	on enter "Devil-Hide"
		conversation
			`<CN-14037>`
			`<CN-14038>`
			`<CN-14039>`
	on visit
		conversation
			`<CN-14040>`
				launch
	on complete
		event "liberated elenchus"
	on fail
		dialog `<DL-602>`

	# IMPORTANT: For story reasons, all non-Unfettered ships must have "save" to ensure
	# the Unfettered get their jump drives back.

	# The fleet on the way to elenchus
	npc save accompany
		government "Hai (Wormhole Access)"
		personality timid escort opportunistic
		ship "Centipede (Teeneep Jump)" "Teeneep's Ship"
	npc save accompany
		government "Hai (Friendly Unfettered)"
		personality escort heroic opportunistic vindictive
		ship "Emperor Beetle" "Kratos"

	npc save accompany
		government "Navy (Oathkeeper)"
		personality escort heroic opportunistic
		ship "Cruiser (Jump Plasma Anti-Missile)" "N.S. Peacemaker"
	npc
		government "Navy (Oathkeeper)"
		personality escort opportunistic
		fleet
			fighters
				names "republic fighter"
			variant
				"Combat Drone (Sidewinder Missiles)" 4
	npc save accompany
		government "Republic"
		personality timid escort opportunistic
		ship "Auxiliary (Jump Transport)" "N.S. Braveheart"
	npc
		government "Republic"
		personality escort opportunistic
		fleet
			fighters
				names "syndicate fighter"
			variant
				"Barb (Proton)" 4
	npc accompany
		government "Free Worlds"
		personality escort heroic opportunistic
		ship "Dreadnought (Plasma Jump)" "F.S. Ironwood"

	# The defenders waiting for you. There are 4 of them, and you have 5 competent allies, and 2 vulnerable allies.
	# This shouldn't be hard, but the longer you take the greater the odds that another pirate ship returns from somewhere and complicates things.
	npc
		government "Pirate (Devil-Run Gang)"
		personality heroic staying waiting
		system "Devil-Hide"
		fleet "Devil-Run Warships" 3
	npc
		government "Pirate (Devil-Run Gang)"
		personality heroic staying waiting
		system "Devil-Hide"
		fleet
			names "pirate"
			variant
				"Palavret"


fleet "Elenchus Tribute"
	government "Pirate (Devil-Run Gang)"
	names "pirate"
	cargo 0
	personality
		heroic plunders harvests
	variant
		"Bactrian"
		"Dagger" 3

		"Leviathan (Laser)"
		"Protector (Proton)"
		"Vanguard (Missile)"
		"Firebird"

# They suspect you're coming so they're on alert, and non-essential ships aren't flying about.
# Also, removing the warship spawn stops your NPC escorts from getting overwhelmed inappropriately.
event "elenchus can be dominated"
	planet "Elenchus"
		tribute 5000
			threshold 2400
			fleet "Elenchus Tribute"
	system "Devil-Hide"
		remove fleet "Devil-Run Warships"
		remove fleet "Devil-Run Miners"


# This allows the mission to preserve the correct number of Unfettered support ships - if one dies it will stay dead:
mission "Hai Reveal [B12-A] Devil-Hide Fleet"
	landing
	invisible
	source "Foundry"
	destination "Hai-home"
	to offer
		has "Hai Reveal [B11] Moving Together: done"
# Safety Feature: Workaround for bug #1938 is to introduce another bug the user is unlikely to trigger. Visit Hai-home with this fleet and it vanishes.
	to complete
		has "Hai Reveal [C01] Cleanup: done"
	to fail
		or
			has "Hai Reveal [B12] Devil-Hide Battle: failed"
			has "Hai Reveal [B12] Devil-Hide Battle: declined"
			has "Hai Reveal [C01] Cleanup: failed"
			has "Hai Reveal [C01] Cleanup: declined"
			has "Hai Reveal [B13] Freedom: failed"
			has "Hai Reveal [B13] Freedom: declined"
	npc accompany
		government "Hai (Friendly Unfettered)"
		personality escort heroic opportunistic vindictive
		fleet
			names "hai"
			variant
				"Shield Beetle (Particle Jump)"
				"Shield Beetle (Plasma Blaster Jump)"



mission "Hai Reveal [B13] Freedom"
	landing
	name "<NM-719>"
	description "<DS-2727>"
	source "Elenchus"
	destination "Stormhold"
	clearance
	to offer
		has "Hai Reveal [B12] Devil-Hide Battle: done"
	on visit
		dialog `<DL-603>`
	on fail
		fail "Hai Reveal [B12-A] Devil-Hide Fleet"
	on decline
		fail "Hai Reveal [B12-A] Devil-Hide Fleet"
	on offer
		log `Factions` `Elenchus` `<LG-419>`
		log `<LG-420>`
		conversation
			`<CN-14041>`
			`<CN-14042>`
			`<CN-14043>`
			`<CN-14044>`
			`<CN-14045>`
			choice
				`<CN-14046>`
					goto "lead on"
				`<CN-14047>`
			`<CN-14048>`
			action
				set "Hai Reveal [B13] Freedom: challenged Choot'k"
			label "lead on"
			`<CN-14049>`
			`<CN-14050>`
			`<CN-14051>`
			`<CN-14052>`
			choice
				`<CN-14053>`
				`<CN-14054>`
					goto leave
			label questions
			choice
				`<CN-14055>`
					goto home
					to display
						not "Hai Reveal [B13] Freedom: label home"
				`<CN-14056>`
					goto "cadmium"
					to display
						not "Hai Reveal [B13] Freedom: label cadmium"
				`<CN-14057>`
					goto place
					to display
						not "Hai Reveal [B13] Freedom: label place"
				`<CN-14058>`
					goto do
					to display
						not "Hai Reveal [B13] Freedom: label do"
						or
							has "Hai Reveal [B13] Freedom: label place"
							has "Hai Reveal [B13] Freedom: label home"
				`<CN-14059>`
					goto space
					to display
						not "Hai Reveal [B13] Freedom: label space"
						has "Hai Reveal [B13] Freedom: label place"
				`<CN-14060>`
					goto korath
					to display
						not "Hai Reveal [B13] Freedom: label korath"
				`<CN-14061>`
					goto "translation services"
					to display
						not "Hai Reveal [B13] Freedom: label translation services"
						has "Hai Reveal [B13] Freedom: label korath"
				`<CN-14054>`
			`<CN-14062>`
				goto leave
			label korath
			action
				set "Hai Reveal [B13] Freedom: label korath"
			`<CN-14063>`
			`<CN-14064>`
			`<CN-14065>`
				goto questions
			label "translation services"
			action
				set "Hai Reveal [B13] Freedom: label translation services"
			`<CN-14066>`
				goto questions
			label "cadmium"
			action
				set "Hai Reveal [B13] Freedom: label cadmium"
			`<CN-14067>`
			`<CN-14068>`
			`<CN-14069>`
			`<CN-14070>`
				goto questions
			label home
			action
				set "Hai Reveal [B13] Freedom: label home"
			`<CN-14071>`
			`<CN-14072>`
			`<CN-14073>`
				goto questions
			label place
			action
				set "Hai Reveal [B13] Freedom: label place"
			`<CN-14074>`
			`<CN-14075>`
			`<CN-14076>`
			`<CN-14077>`
				goto questions
			label do
			action
				set "Hai Reveal [B13] Freedom: label do"
			`<CN-14078>`
			`<CN-14079>`
				goto questions
			label space
			action
				set "Hai Reveal [B13] Freedom: label space"
			`<CN-14080>`
			`<CN-14081>`
			`<CN-14082>`
				goto questions
			label leave
			`<CN-14083>`
			`<CN-14084>`
			`<CN-14085>`
			choice
				`<CN-14086>`
				`<CN-14087>`
					goto impatient
			`<CN-14088>`
			`<CN-14089>`
			`<CN-14090>`
				goto reason
			label impatient
			`<CN-14091>`
			label reason
			choice
				`<CN-14092>`
					goto "know duty"
				`<CN-14093>`
					goto "know hai"
				`<CN-14094>`
					goto "know syndicate"
				`<CN-14095>`
			`<CN-14096>`
				goto finished
			label "know hai"
			`<CN-14097>`
				goto finished
			label "know syndicate"
			`<CN-14098>`
				goto finished
			label "know duty"
			`<CN-14099>`
				goto finished
			label finished
			`<CN-14100>`
			choice
				`<CN-14101>`
					goto surprised
				`<CN-14102>`
			`<CN-14103>`
				goto done
			label surprised
			`<CN-14104>`
			label done
			`<CN-14105>`
			`<CN-14106>`
				accept
	on complete
		payment 1000000
	npc save accompany
		government "Hai (Wormhole Access)"
		personality timid escort opportunistic
		ship "Centipede (Teeneep Jump)" "Teeneep's Ship"
	npc save accompany
		government "Hai (Friendly Unfettered)"
		personality escort heroic opportunistic vindictive
		ship "Emperor Beetle" "Kratos"
	npc save accompany
		government "Navy (Oathkeeper)"
		personality escort heroic opportunistic
		ship "Cruiser (Jump Plasma Anti-Missile)" "N.S. Peacemaker"



mission "Hai Reveal [B13-G] Elenctic Guard"
	landing
	invisible
	source "Elenchus"
	to offer
		has "Hai Reveal [B12] Devil-Hide Battle: done"
	npc kill
		government "Elenctic Commune"
		personality heroic staying
		system "Devil-Hide"
		fleet
			names "civilian"
			variant
				"Palavret"
				"Leviathan (Hai Engines)"
				"Leviathan (Hai Weapons)"
				"Firebird (Laser)"
				"Firebird (Laser)"
				"Firebird (Laser)"



mission "Hai Reveal [B14] Journey to Peace"
	landing
	name "<NM-719>"
	description "<DS-2728>"
	source "Stormhold"
	stopover "Mountaintop"
	destination "Hai-home"
	clearance
	passengers 4
	to offer
		has "Hai Reveal [B13] Freedom: done"
	on visit
		dialog `<DL-604>`
	on offer
		conversation
			`<CN-14107>`
			`<CN-14108>`
			`<CN-14109>`
				accept
	npc save accompany
		government "Hai (Wormhole Access)"
		personality timid escort opportunistic
		ship "Centipede (Teeneep)" "Teeneep's Ship"
	npc save accompany
		government "Hai (Friendly Unfettered)"
		personality escort heroic opportunistic vindictive
		ship "Emperor Beetle" "Kratos"
