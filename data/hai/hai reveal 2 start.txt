# Copyright (c) 2020 MasterOfGrey
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.

########################################################################

# Investigate a theorized smuggling route and rescue Hai. You have to do at least three of these missions.

# NOTE: The Hai Leaks Response 6 and 7 missions will break if any of these missions have Hai-home as a destination.

# Logic Register (don't delete)
# # Some subset of these are restricted so you can't pick up enough of them (total 3) to finish the quest at the same time as starting it.
# # Rescues which don't trigger on landing have hints which don't expire until you visit the spaceport at the rescue site so players don't lose them.
# # (Note: The overarching mission description tells you to check spaceports.)
#
# Main Event:
# # Gipeep
# - Minor People logs
# - Cannot be discovered pre-story
# - Includes information to support later progress (critical to at least encounter)
#
# Secondary Events:
# # Yeertle Family and Oonem
# - Minor People logs
# - Can be discovered pre-story (foreshadowing)
# - Potential for recurring appearances
# - to offer
#		or
#			has "Unwanted Cargo: done"
#			has "Hai Leaks Response 6: offered"
# - needs: not "event: hai-human treaty signed"
#
# Filler Events:
# # Prison RPers, Meroot & Lucy
# - Only mission logs
# - Cannot be discovered pre-story
# - to offer
#		has "Hai Leaks Response 6: active"
#


mission "Hai Rescue: Yeertle Hint"
	landing
	name "<NM-679>"
	description `<DS-2676>`
	source
		near "Betelgeuse" 4
		government "Republic" "Syndicate"
		attributes "spaceport"
		not attributes "station"
		not planet "Prime"
	destination Prime
	to offer
		"combat rating" > 50
		has "Hai Leaks Response 6: active"
		has "event: slightly lost"
		not "Hai Rescue: Yeertle Family: offered"
		not "event: hai-human treaty signed"
		random < 50
	on offer
		conversation
			`<CN-12909>`
			`<CN-12910>`
			`<CN-12911>`
				accept
	to complete
		has "Hai Rescue: Yeertle Family: offered"
	to fail
		has "event: hai-human treaty signed"


mission "Hai Rescue: Yeertle Family"
	name "<NM-680>"
	description "<DS-2677>"
	source Prime
	destination Icelake
	passengers 5
	to offer
		"combat rating" > 50
		or
			has "Unwanted Cargo: done"
			has "Hai Leaks Response 6: offered"
		not "event: hai-human treaty signed"
		"Hai Rescue: Yeertle Family (defer count)" < 3
	on defer
		"Hai Rescue: Yeertle Family (defer count)" ++
	on offer
		conversation
			branch "no hint"
				not "Hai Rescue: Yeertle Hint: offered"
			`<CN-12912>`
				goto start
			label "no hint"
			`<CN-12913>`
			label start
			`<CN-12914>`
			choice
				`<CN-12915>`
				`<CN-12916>`
					defer
			`<CN-12917>`
			`<CN-12918>`
			`<CN-12919>`
			choice
				`<CN-12920>`
					goto far
				`<CN-12921>`
					goto "ride offer"
				`<CN-12922>`
					goto "made in a cave"
			label "made in a cave"
			`<CN-12923>`
			choice
				`<CN-12924>`
				`<CN-12925>`
			`<CN-12926>`
			`<CN-12927>`
			choice
				`<CN-12921>`
					goto "ride offer"
				`<CN-12920>`
			`<CN-12928>`
				goto "questioned first"
			label far
			`<CN-12929>`
			`<CN-12930>`
			label "questioned first"
			`<CN-12931>`
			`<CN-12932>`
			choice
				`<CN-1927>`
				`<CN-12933>`
					goto looking
				`<CN-12934>`
					decline
			`<CN-12935>`
				goto leave
			label "ride offer"
			`<CN-12936>`
			`<CN-12937>`
				goto leave
			label looking
			`<CN-12938>`
			`<CN-12939>`
			`<CN-12940>`
			choice
				`<CN-12921>`
					goto "ride offer"
				`<CN-12941>`
			`<CN-12942>`
				goto leave
			label leave
			`<CN-12943>`
			choice
				`<CN-5307>`
			`<CN-12944>`
			`<CN-12945>`
			`<CN-12946>`
			`<CN-12947>`
				launch
	on accept
		dialog `<DL-563>`
	on complete
		log `<LG-379>`
		log "Minor People" "Duniip Yeertle" `<LG-380>`
		payment 350000
		"hai slave prereq" ++
		dialog `<DL-564>`
	npc
		government "Bounty Hunter that Won't Enter Hai Space"
		personality plunders disables unconstrained
		fleet "Small Core Pirates" 1



mission "Hai Rescue: Ooonem Hint"
	landing
	name "<NM-681>"
	description "<DS-2678>"
	source
		near "Alcyone" 3
		government "Republic" "Syndicate"
		attributes "spaceport"
		not attributes "station"
		not planet "Stormhold"
	destination Stormhold
	to offer
		has "Hai Leaks Response 6: active"
		has "event: slightly lost"
		not "Hai Rescue: Ooonem: offered"
		not "Hai Reveal [B01-A] The Blockade Goes Up: offered"
		random < 30
	on offer
		conversation
			`<CN-12948>`
			`<CN-12949>`
			`<CN-12950>`
				accept
	to complete
		has "Hai Rescue: Ooonem: offered"
	to fail
		has "Hai Reveal [B01-A] The Blockade Goes Up: offered"


mission "Hai Rescue: Ooonem"
	name "<NM-682>"
	description "<DS-2679>"
	source "Stormhold"
	destination "Makerplace"
	passengers 1
	to offer
		"combat rating" > 50
		or
			has "Unwanted Cargo: done"
			has "Hai Leaks Response 6: offered"
		not "Hai Reveal [B01-A] The Blockade Goes Up: offered"
		"Hai Rescue: Ooonem (defer count)" < 3
	on defer
		"Hai Rescue: Ooonem (defer count)" ++
	on offer
		conversation
			branch transmitter
				has "Ooonem Transmitter"
			branch "no hint"
				and
					not "Hai Rescue: Ooonem Hint: offered"
					not "Hai Rescue: Ooonem (defer count)"
			`<CN-12951>`
				goto start
			label "no hint"
			`<CN-12952>`
			`<CN-12953>`
			choice
				`<CN-12954>`
				`<CN-12916>`
					defer
			`<CN-12955>`
			label start
			choice
				`<CN-4138>`
				`<CN-12916>`
					defer
			`<CN-12956>`
			`<CN-12957>`
			choice
				`<CN-12958>`
					goto hai
				`<CN-12959>`
					goto who
				`<CN-12960>`
					goto decline
			label hai
			`<CN-12961>`
				goto "more questions"
			label who
			`<CN-12962>`
				goto "more questions"
			label pay
			`<CN-12963>`
				goto "more questions"
			label "more questions"
			`<CN-12964>`
			choice
				`<CN-12965>`
				`<CN-7608>`
					goto pay
				`<CN-12966>`
					goto hai
				`<CN-12967>`
					goto who
				`<CN-12968>`
					goto decline
			`<CN-12969>`
			choice
				`<CN-12970>`
					goto go
				`<CN-12971>`
				`<CN-12972>`
					decline
			`<CN-12973>`
			action
				set "Ooonem Transmitter"
			`<CN-12974>`
				defer
			label transmitter
			`<CN-12975>`
			`<CN-12976>`
			choice
				`<CN-12977>`
				`<CN-12978>`
					goto decline
			label go
			`<CN-12979>`
			`<CN-12980>`
			`<CN-12981>`
			`<CN-12982>`
				launch
			label decline
			`<CN-12983>`
				decline
	on accept
		dialog `<DL-565>`
	on complete
		log `<LG-381>`
		log "Minor People" "Ooonem" `<LG-382>`
		payment 225000
		"hai slave prereq" ++
		dialog `<DL-566>`
	npc
		government "Bounty Hunter that Won't Enter Hai Space"
		personality plunders disables unconstrained
		fleet "Large Core Pirates" 1
		fleet "Small Core Pirates" 1



mission "Hai Rescue: Prison RP Hint"
	landing
	name "<NM-683>"
	description "<DS-2680>"
	source
		near "Mirfak" 4
		government "Republic" "Syndicate"
		attributes "spaceport"
		not attributes "station"
		not planet "Sunracer"
	destination Sunracer
	to offer
		has "Hai Leaks Response 6: active"
		has "event: slightly lost"
		not "Hai Rescue: Prison Role-Players: offered"
		not "event: hai-human treaty signed"
		random < 80
	on offer
		conversation
			`<CN-12984>`
			`<CN-12985>`
			`<CN-12986>`
				accept
	to fail
		not "Hai Leaks Response 6: active"


mission "Hai Rescue: Prison Role-Players"
	# You get to rescue the Hai from "First Contact: Hai"
	landing
	name "<NM-684>"
	description "<DS-2681>"
	source "Sunracer"
	destination "Allhome"
	passengers 5
	to offer
		has "Hai Leaks Response 6: active"
		not "event: hai-human treaty signed"
		"Hai Rescue: Prison Role-Players (defer count)" < 3
		# No combat rating requirement since there are no NPCs.
	on defer
		"Hai Rescue: Prison Role-Players (defer count)" ++
	on offer
		conversation
			`<CN-12987>`
			choice
				`<CN-12988>`
				`<CN-12989>`
					defer
			`<CN-12990>`
			`<CN-12991>`
				goto "actual questions"
			label questions
			`<CN-12992>`
			label "actual questions"
			choice
				`<CN-12993>`
					goto go
				`<CN-12994>`
					goto who
				`<CN-12995>`
					goto how
				`<CN-7608>`
					goto pay
				`<CN-12996>`
					defer
			label who
			`<CN-12997>`
				goto questions
			label how
			`<CN-12998>`
			`<CN-12999>`
				goto questions
			label pay
			`<CN-13000>`
				goto questions
			label go
			`<CN-13001>`
				accept
	on complete
		log `<LG-383>`
		payment 565000
		"hai slave prereq" ++
		dialog `<DL-567>`
	# No NPCs for this one since the pirates are presumed dead.



mission "Hai Rescue: Meroot and Lucy Hint"
	landing
	name "<NM-685>"
	description "<DS-2682>"
	source
		near "Zaurak" 4
		government "Republic" "Syndicate"
		attributes "spaceport"
		not attributes "station"
		not planet "Canyon"
	destination Canyon
	to offer
		"combat rating" > 50
		has "Hai Leaks Response 6: active"
		has "event: slightly lost"
		not "Hai Rescue: Meroot and Lucy: offered"
		not "event: hai-human treaty signed"
		random < 80
	on offer
		conversation
			`<CN-13002>`
				accept
	to complete
		has "Hai Rescue: Meroot and Lucy: offered"
	to fail
		has "event: hai-human treaty signed"


mission "Hai Rescue: Meroot and Lucy"
	name "<NM-686>"
	description "<DS-2683>"
	source Canyon
	destination Newhome
	passengers 2
	to offer
		"combat rating" > 50
		has "Hai Leaks Response 6: active"
		not "event: hai-human treaty signed"
		"Hai Rescue: Meroot and Lucy (defer count)" < 3
	on defer
		"Hai Rescue: Meroot and Lucy (defer count)" ++
	on offer
		conversation
			`<CN-13003>`
			`<CN-13004>`
			choice
				`<CN-4242>`
				`<CN-12916>`
					defer
			`<CN-13005>`
			`<CN-13006>`
			choice
				`<CN-13007>`
					goto hiding
				`<CN-4593>`
					goto help
				`<CN-13008>`
					decline
			label hiding
			`<CN-13009>`
				goto "trust check"

			label help
			`<CN-13010>`
			label "trust check"
			`<CN-13011>`
			choice
				`<CN-13012>`
					goto "come in"
				`<CN-13013>`
			`<CN-13014>`
			choice
				`<CN-13015>`
			label "come in"
			`<CN-13016>`
			`<CN-13017>`
			`<CN-13018>`
			`<CN-13019>`
			choice
				`<CN-13020>`
				`<CN-13021>`
					decline
			`<CN-13022>`
			`<CN-13023>`
			`<CN-13024>`
			`<CN-13025>`
			`<CN-13026>`
			choice
				`<CN-13027>`
				`<CN-13028>`
					decline
			`<CN-13029>`
				launch
	on complete
		log `<LG-384>`
		payment 315000
		"hai slave prereq" ++
		dialog `<DL-568>`
	npc
		government "Bounty Hunter that Won't Enter Hai Space"
		personality plunders disables unconstrained
		fleet "Large Core Pirates" 1
		fleet "Small Core Pirates" 1



mission "Hai Rescue: Gipeep Hint"
	landing
	name "<NM-687>"
	description "<DS-2684>"
	source
		near "Nihal" 4
		government "Republic" "Syndicate"
		attributes "spaceport"
		not attributes "station"
		not planet "Maelstrom"
	destination Maelstrom
	to offer
		"combat rating" > 50
		has "Hai Leaks Response 6: active"
		has "event: slightly lost"
		not "Hai Rescue: Gipeep: offered"
		not "event: hai-human treaty signed"
		random < 80
	on offer
		conversation
			`<CN-13030>`
				accept
	to fail
		has "event: hai-human treaty signed"


mission "Hai Rescue: Gipeep"
	landing
	name "<NM-688>"
	description "<DS-2679>"
	source "Maelstrom"
	destination "Greenbloom"
	passengers 1
	to offer
		"combat rating" > 50
		has "Hai Leaks Response 6: active"
		not "event: hai-human treaty signed"
	on offer
		conversation
			branch hint
				has "Hai Rescue: Gipeep Hint: offered"
			`<CN-13031>`
			label hint
			`<CN-13032>`
			choice
				`<CN-610>`
				`<CN-835>`
					decline
			`<CN-13033>`
			choice
				`<CN-13034>`
				`<CN-835>`
					decline
			`<CN-13035>`
			`<CN-13036>`
			choice
				`<CN-6575>`
				`<CN-835>`
					decline
			`<CN-13037>`
			`<CN-13038>`
			`<CN-13039>`
			choice
				`<CN-13040>`
					goto accept
				`<CN-13041>`
			`<CN-13042>`
			choice
				`<CN-13043>`
				`<CN-13044>`
					decline
			label accept
			`<CN-13045>`
			`<CN-13046>`
			`<CN-13047>`
				launch
	on complete
		log `<LG-385>`
		log "Minor People" "Gipeep Anl'ooh" `<LG-386>`
		payment 285000
		"hai slave prereq" ++
		dialog `<DL-569>`
	npc
		government "Bounty Hunter that Won't Enter Hai Space"
		personality plunders disables unconstrained
		fleet "Large Northern Pirates" 1
		fleet "Small Northern Pirates" 1
