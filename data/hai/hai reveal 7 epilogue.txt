# Copyright (c) 2020 MasterOfGrey
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.

########################################################################

mission "Hai Reveal [D00] Resolution Timer"
	landing
	invisible
	to offer
		has "event: hai-human resolution announced"
	on offer
		event "hai-human treaty prepared" 160 200
		fail

event "hai-human treaty prepared"


mission "Hai Reveal [D01A] Summoned to Mountaintop"
	landing
	name "<NM-722>"
	description "<DS-2735>"
	source
		government "Republic" "Syndicate" "Free Worlds"
		not attributes "uninhabited"
	destination "Mountaintop"
	to offer
		not "Hai Reveal [D01B] Summoned to Mountaintop: offered"
		# This makes sure that the background missions for the danger of traveling to Hai space can still happen (as they definitely don't work after this section).
		# This also means that a lot of great content doesn't get excluded for players who don't find the Hai before finishing the main plot just because new content has been added.
		has "event: hai-human treaty prepared"
		has "Nanachi 4: done"
		# Nanachi is too long a chain to do in the middle of the main story, the starting conditions have been changed to be available as soon as you're famous and not busy.
		has "Expanding Business [4]: done"
		# Expanding Business capitalizes on the situation to get the first part started.
		has "Wanderers: Alpha Surveillance J: done"
		# Sets the right characters and ensures the Unfettered are well distracted and out of the picture.
	on offer
		event "cardax site chosen"
		conversation
			# A message summons you for the treaty resolution.
			`<CN-14237>`
			`<CN-14238>`
			`<CN-14239>`
				accept
	
mission "Hai Reveal [D01B] Summoned to Mountaintop"
	landing
	name "<NM-722>"
	description "<DS-2735>"
	source
		government "Hai"
		not attributes "uninhabited"
	destination "Mountaintop"
	to offer
		not "Hai Reveal [D01A] Summoned to Mountaintop: offered"
		# This makes sure that the background missions for the danger of traveling to Hai space can still happen (as they definitely don't work after this section).
		# This also means that a lot of great content doesn't get excluded for players who don't find the Hai before finishing the main plot just because new content has been added.
		has "event: hai-human treaty prepared"
		has "Nanachi 4: done"
		# Nanachi is too long a chain to do in the middle of the main story, the starting conditions have been changed to be available as soon as you're famous and not busy.
		has "Expanding Business [4]: done"
		# Expanding Business capitalizes on the situation to get the first part started.
		has "Wanderers: Alpha Surveillance J: done"
		# Sets the right characters and ensures the Unfettered are well distracted and out of the picture.
	on offer
		event "cardax site chosen"
		conversation
			# A message summons you for the treaty resolution.
			`<CN-14237>`
			`<CN-14239>`
				accept
	
# Redefine Cardax to have a named location for the station.
event "cardax site chosen"
	system Cardax
		add object
			distance 667.205
			period 166.95
			object Mooncreek
				sprite "effect/flotsam yottrite"
				distance 212
				period 31.1964
	
	planet Mooncreek
		government "Unknown"
		# Placeholder description; you can't actually land.
		description `<DS-2736>`
		"required reputation" 1000



mission "Hai Reveal [D02] Escort to Cardax"
	landing
	name "<NM-723>"
	description "<DS-2737>"
	source "Mountaintop"
	destination "Mooncreek"
	clearance
	on visit
		dialog `<DL-607>`
	to offer
		or
			has "Hai Reveal [D01A] Summoned to Mountaintop: done"
			has "Hai Reveal [D01B] Summoned to Mountaintop: done"
	on offer
		event "cardax pirates waiting"
		conversation
			`<CN-14240>`
			`<CN-14241>`
			`<CN-14242>`
			`<CN-14243>`
			choice
				`<CN-14244>`
					goto alphas
				`<CN-14245>`
			`<CN-14246>`
				goto main
			label alphas
			`<CN-14247>`
			`<CN-14248>`
			`<CN-14249>`
			label main
			`<CN-14250>`
			`<CN-14251>`
			`<CN-14252>`
			choice
				`<CN-14253>`
			`<CN-14254>`
			`<CN-14255>`
			choice
				`<CN-14256>`
			`<CN-14257>`
			`<CN-14258>`
			choice
				`<CN-14259>`
				`<CN-14260>`
			`<CN-14261>`
				accept
	on visit
		dialog "<DL-608>"
	npc accompany save
		personality escort timid
		government "Hai (Wormhole Access)"
		ship Geocoris "Du Pli Hey"
	npc
		government "Hai (Wormhole Access)"
		personality escort heroic
		fleet "Anti-Pirate Hai (Wormhole Travel)" 2
	npc kill
		government "Pirate"
		personality staying disables plunders harvests
		system "Cardax"
		fleet "Marauder fleet IX" 3
	
	
# Specific pirates are added as NPC's in the mission.
event "cardax pirates waiting"
	system Cardax
		remove fleet "Small Northern Pirates"
		remove fleet "Large Northern Pirates"
		remove fleet "Small Core Pirates"
	planet Mooncreek
		"required reputation" -10
	
	
mission "Hai Reveal [D03] Defend Mooncreek Construction Site"
	landing
	name "<NM-723>"
	description "<DS-2738>"
	source "Mooncreek"
	destination "Mooncreek"
	on visit
		dialog `<DL-609>`
	to offer
		has "Hai Reveal [D02] Escort to Cardax: done"
	on offer
		event "mooncreek founded"
		conversation
			`<CN-14262>`
			`<CN-14263>`
				accept
	npc
		government "Hai (Wormhole Access)"
		personality escort heroic
		fleet "Anti-Pirate Hai (Wormhole Travel)" 2
	npc accompany
		government "Republic"
		system "Ultima Thule"
		personality heroic escort
		fleet
			names "republic capital"
			fighters
				names "republic fighter"
			variant
				"Carrier (Mark II)" 3
				"Lance" 12
				"Combat Drone" 18
				"Cruiser (Mark II)" 3
				"Combat Drone" 12
	npc accompany save
		government "Hai (Wormhole Access)"
		system "Ultima Thule"
		personality escort timid
		ship Geocoris "Du Cor Hey"
		ship Geocoris "Mon Yo Sen"
		ship Geocoris "Vai e Lur"
		ship Geocoris "Du Woa Ow"
		ship Geocoris "Luf Sook Hey"
		ship Geocoris "Du Eh"
		ship Geocoris "Mon e Ow"
	npc
		government "Pirate"
		system Alcyone
		personality heroic unconstrained waiting nemesis
		fleet "Marauder fleet X"
		fleet "Marauder fleet IX" 4
	
	
# Update sprite & planet, and restore regular pirates.
event "mooncreek founded"
	system Cardax
		remove object
			distance 667.205
			period 166.95
		add object
			distance 667.205
			period 166.95
			object Mooncreek
				sprite "planet/station hai geocoris"
				distance 212
				period 31.1964
		add fleet "Small Northern Pirates" 1000
		add fleet "Large Northern Pirates" 3000
		add fleet "Small Core Pirates" 2000
	planet Mooncreek
		government "Hai"
		attributes uninhabited
		landscape land/station0
		description `<DS-2739>`
		security 0.2
	
	
mission "Hai Reveal [D04] Escort Republic Outfitters"
	landing
	name "<NM-724>"
	description "<DS-2740>"
	source "Mooncreek"
	destination "Maelstrom"
	to offer
		has "Hai Reveal [D03] Defend Mooncreek Construction Site: done"
	on offer
		event "mooncreek operational"
		payment 10000000
		conversation
			`<CN-14264>`
			`<CN-14265>`
			`<CN-14266>`
			choice
				`<CN-14267>`
					goto fantastic
				`<CN-14268>`
			`<CN-14269>`
			`<CN-14270>`
			label fantastic
			`<CN-14271>`
			`<CN-14272>`
			`<CN-14273>`
			choice
				`<CN-8727>`
					goto escort
				`<CN-14274>`
			`<CN-14275>`
			`<CN-14276>`
				decline
			label escort
			`<CN-14277>`
				accept
	
	
# Update sprite & planet, and add security patrol to counter regular pirates.
event "mooncreek operational"
	system Cardax
		government "Hai"
		remove object
			distance 667.205
			period 166.95
		add object
			distance 667.205
			period 166.95
			object Mooncreek
				sprite "planet/station hai eight geocoris"
				distance 212
				period 31.1964
		add fleet "Anti-Pirate Hai (Wormhole Travel)" 2000
	planet Mooncreek
		remove attributes uninhabited
		description `<DS-2741>`
		security 0.4


mission "Hai Reveal [D05] Escort Republic Outfitters"
	landing
	name "<NM-723>"
	description "<DS-2742>"
	source "Maelstrom"
	destination "Mooncreek"
	on visit
		dialog `<DL-609>`
	to offer
		has "Hai Reveal [D04] Escort Republic Outfitters: done"
	on offer
		conversation
			`<CN-14278>`
				accept
	npc accompany save
		personality escort heroic
		government Republic
		ship "Behemoth (Heavy)" "R.N.S. Bungles"
		ship "Behemoth (Heavy)" "R.N.S. Humble"
		ship "Behemoth (Heavy)" "R.N.S. Sensible"
		ship "Behemoth (Heavy)" "R.N.S. Temperate"
	npc accompany save
		personality escort heroic
		government Republic
		fleet
			names "republic capital"
			fighters
				names "republic fighter"
			variant
				"Carrier"
				"Lance" 4
				"Combat Drone" 6
				"Frigate" 2
				"Gunboat" 3
				"Rainmaker" 3


mission "Hai Reveal [D06] Escort Syndicate Outfitters"
	landing
	name "<NM-724>"
	description "<DS-2740>"
	source "Mooncreek"
	destination "Sunracer"
	to offer
		has "Hai Reveal [D05] Escort Republic Outfitters: done"
	on offer
		event "mooncreek republic garrison"
		conversation
			`<CN-14279>`
			`<CN-14280>`
			`<CN-14281>`
			choice
				`<CN-5458>`
				`<CN-14282>`
			`<CN-14283>`
				accept


event "mooncreek republic garrison"
	system Cardax
		add fleet "Small Republic" 1500
		add fleet "Large Republic" 3000


mission "Hai Reveal [D07] Escort Syndicate Outfitters"
	landing
	name "<NM-723>"
	description "<DS-2742>"
	source "Sunracer"
	destination "Mooncreek"
	on visit
		dialog `<DL-609>`
	to offer
		has "Hai Reveal [D06] Escort Syndicate Outfitters: done"
	on offer
		event "mooncreek spaceport"
		conversation
			`<CN-14284>`
				accept
	npc accompany save
		personality escort timid
		government Syndicate
		ship Freighter "S.S. Raleigh"
		ship Freighter "S.S. Scott"
		ship Freighter "S.S. Hudson"
		ship Freighter "S.S. Drake"
		ship Freighter "S.S. Magellan"
		ship Freighter "S.S. Franklin"
	npc accompany save
		personality escort heroic
		government Syndicate
		fleet
			names "syndicate capital"
			variant
				"Splinter (Mark II)" 2
				"Manta (Mark II)" 3
				"Quicksilver (Mark II)" 6
				"Protector" 8


event "mooncreek spaceport"
	planet Mooncreek
		attributes hai military north frontier
		spaceport `<SP-588>`
		security 0.6


mission "Hai Reveal [D08] Escort Hai Outfitters"
	landing
	name "<NM-725>"
	description "<DS-2743>"
	source "Mooncreek"
	destination "Mountaintop"
	passengers 1
	to offer
		has "Hai Reveal [D07] Escort Syndicate Outfitters: done"
	on offer
		event "mooncreek syndicate garrison"
		conversation
			`<CN-14285>`
			`<CN-14286>`
			choice
				`<CN-14287>`
				`<CN-133>`
			`<CN-14288>`
			`<CN-14289>`
				accept


event "mooncreek syndicate garrison"
	system Cardax
		add fleet "Small Syndicate" 1500
		add fleet "Large Syndicate" 3000


mission "Hai Reveal [D09] Escort Hai Outfitters"
	landing
	name "<NM-723>"
	description "<DS-2742>"
	source "Mountaintop"
	destination "Mooncreek"
	passengers 1
	on visit
		dialog `<DL-609>`
	to offer
		has "Hai Reveal [D08] Escort Hai Outfitters: done"
	on offer
		conversation
			`<CN-14290>`
				accept
	npc accompany save
		personality escort timid
		government "Hai (Wormhole Access)"
		ship Geocoris "Du Cor Hey"
		ship Geocoris "Mon Yo Sen"
		
		
# The Free Worlds demand a tour so they can be seen to be contributing to the wider benefit of humanity. (They're PR hogs.)
# This will need branches in the event of future alternative campaigns.
mission "Hai Reveal [D10] Escort Free World Outfitters"
	landing
	name "<NM-724>"
	description "<DS-2740>"
	source "Mooncreek"
	destination "Solace"
	passengers 1
	to offer
		has "Hai Reveal [D09] Escort Hai Outfitters: done"
	on offer
		event "mooncreek main outfitters" 15
		conversation
			`<CN-14291>`
			`<CN-14292>`
			choice
				`<CN-14293>`
				`<CN-14294>`
			`<CN-14295>`
			`<CN-14296>`
			`<CN-14297>`
			`<CN-14298>`
			choice
				`<CN-14299>`
			`<CN-14300>`
			`<CN-14301>`
			`<CN-14302>`
			choice
				`<CN-14303>`
					accept
				`<CN-14304>`
			`<CN-14305>`
			`<CN-14306>`
			`<CN-14307>`
			choice
				`<CN-14308>`
					accept
				`<CN-14309>`
					decline
			
		

mission "Hai Reveal [D11] Escort Free World Outfitters"
	landing
	name "<NM-725>"
	description "<DS-2744>"
	source "Solace"
	destination "Rust"
	passengers 1
	on visit
		dialog `<DL-609>`
	to offer
		has "Hai Reveal [D10] Escort Free World Outfitters: done"
	on offer
		conversation
			`<CN-14310>`
				accept
	npc accompany save
		personality escort timid
		government "Free Worlds"
		ship "Hauler III" "F.S. Terebinth"
		ship "Hauler III" "F.S. Tamarack"
		ship "Hauler III" "F.S. Juniper"


mission "Hai Reveal [D12] Escort Free World Outfitters"
	autosave
	landing
	name "<NM-723>"
	description "<DS-2742>"
	source "Rust"
	destination "Mooncreek"
	passengers 1
	on visit
		dialog `<DL-609>`
	to offer
		has "Hai Reveal [D11] Escort Free World Outfitters: done"
	on offer
		conversation
			`<CN-14311>`
			`<CN-14312>`
			`<CN-14313>`
				accept
	on fail
		dialog "<DL-610>"
	npc accompany save
		personality escort timid
		government "Free Worlds"
		ship "Hauler III" "F.S. Terebinth"
		ship "Hauler III" "F.S. Tamarack"
		ship "Hauler III" "F.S. Juniper"
		ship "Hauler III" "F.S. Ponderosa"
		ship "Hauler III" "F.S. Bartlett"
		ship "Hauler III" "F.S. Sycamore"
	npc
		government "Pirate"
		system Shaula
		personality heroic unconstrained waiting nemesis
		fleet "Marauder fleet X"
		fleet "Marauder fleet IX" 2
	npc
		government "Pirate"
		system Gienah
		personality heroic unconstrained waiting nemesis
		fleet "Marauder fleet X"
		fleet "Marauder fleet IX" 2
	npc
		government "Pirate"
		system Alcyone
		personality heroic unconstrained waiting nemesis
		fleet "Marauder fleet X"
		fleet "Marauder fleet IX" 2
	npc
		government "Pirate"
		system Almaaz
		personality heroic unconstrained waiting nemesis
		fleet "Marauder fleet X"
		fleet "Marauder fleet IX" 2


event "mooncreek main outfitters"
	planet Mooncreek
		add outfitter "Lovelace Security"
		add outfitter "Syndicated Security"
		add outfitter "Hai Security"
		security 0.8

# Kraz & Delta V
event "mooncreek fw outfitters"
	planet Mooncreek
		add outfitter "FW Security"


# add syndicate hai and republic outfitters event - do not add FW outfitter event - proceed to trigger story conclusion.
mission "Hai Reveal [D0XA] Skipped Mooncreek Escorts"
	landing
	invisible
	to offer
		has "Hai Reveal [D04] Escort Republic Outfitters: declined"
	on offer
		event "mooncreek main outfitters" 30
		fail
	
mission "Hai Reveal [D0XB] Skipped Mooncreek Escorts"
	landing
	name "<NM-726>"
	description "<DS-2745>"
	destination "Mountaintop"
	to offer
		has "mooncreek main outfitters"
		not "Hai Reveal [D04] Escort Republic Outfitters: done"
	on offer
		conversation
			`<CN-14314>`
				accept

mission "Hai Reveal [D0XC] Skipped Mooncreek Escorts"
	landing
	name "<NM-726>"
	description "<DS-2745>"
	destination "Mountaintop"
	to offer
		has "mooncreek main outfitters"
		has "Hai Reveal [D10] Escort Free World Outfitters: declined"
	on offer
		conversation
			`<CN-14314>`
				accept
	

mission "Hai Reveal [D13] Travel to Mountaintop"
	landing
	name "<NM-727>"
	description "<DS-2746>"
	source "Mooncreek"
	destination "Mountaintop"
	passengers 1
	to offer
		has "Hai Reveal [D12] Escort Free World Outfitters: done"
	on offer
		event "mooncreek fw outfitters" 12
		payment 6000000
		conversation
			`<CN-14315>`
				accept


mission "Hai Reveal [D14] Hai-Human Treaty"
	landing
	name "<NM-727>"
	description "<DS-2747>"
	source "Mountaintop"
	to offer
		or
			has "Hai Reveal [D13] Travel to Mountaintop: done"
			has "Hai Reveal [D0XB] Skipped Mooncreek Escorts: done"
			has "Hai Reveal [D0XC] Skipped Mooncreek Escorts: done"
	on offer
		event "hai-human treaty signed"
		event "mooncreek realized" 15
		payment 12000000
		conversation
			`<CN-14316>`
			`<CN-14317>`
			`<CN-14318>`
			`<CN-14319>`
				decline


# The final conclusion event.
event "hai-human treaty signed"


ship "Boxwing" "Boxwing (Miner)"
	outfits
		"KP-6 Photovoltaic Array"
		"X1700 Ion Thruster"
		"X1200 Ion Steering"


fleet "Cardax Miners"
	government "Republic"
	names "republic fighter"
	cargo 0
	personality
		plunders mining harvests
	variant 6
		"Boxwing (Miner)" 4
		"Dagger (Miner)" 4
	variant 4
		"Boxwing (Miner)" 5
		"Dagger (Miner)" 5
	variant 3
		"Boxwing (Miner)" 6
		"Dagger (Miner)" 6
	variant 2
		"Boxwing (Miner)" 7
		"Dagger (Miner)" 7


shipyard "Cardax Miners"
	"Boxwing (Miner)"
	"Dagger (Miner)"


event "mooncreek realized"
	system Cardax
		add fleet "Cardax Miners" 1800
	planet Mooncreek
		spaceport `<SP-589>`
		add shipyard "Cardax Miners"
		security 0.9
	system Moktar
		add fleet "Anti-Pirate Hai (Wormhole Travel)" 2000
	system Volax
		add fleet "Anti-Pirate Hai (Wormhole Travel)" 2000
	system Sumar
		fleet "Small Northern Pirates" 4000
		fleet "Large Northern Pirates" 8000
		add fleet "Anti-Pirate Hai (Wormhole Travel)" 2000
	system Danoa
		fleet "Small Northern Pirates" 7000
		fleet "Large Northern Pirates" 16000
		add fleet "Anti-Pirate Hai (Wormhole Travel)" 5000
	system Hassaleh
		fleet "Small Northern Pirates" 8000
		fleet "Large Northern Pirates" 20000
		add fleet "Anti-Pirate Hai (Wormhole Travel)" 5000
	system Rajak
		fleet "Small Northern Pirates" 7000
		fleet "Large Northern Pirates" 12000
		add fleet "Anti-Pirate Hai (Wormhole Travel)" 2000
	system Rigel
		add fleet "Anti-Pirate Hai (Wormhole Travel)" 11000
