# Copyright (c) 2015 by Michael Zahniser
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.

conversation "assisting merchant"
	`${assist merchant 1} <origin>${assist merchant 2} ${assist merchant 3} <payment>${assist merchant 4}`
		decline

conversation "assisting merchant hazardous"
	`${assist merchant 1 hazardous} <origin>${assist merchant 2} ${assist merchant 3} <payment>${assist merchant 4}`
		decline

mission "Assisting Merchant (Small)"
	assisting
	repeat
	minor
	to offer
		random < 20
	source
		government "Merchant"
		category "Interceptor" "Light Warship" "Transport" "Light Freighter"
		not attributes "automaton"
	on offer
		payment 10000
		conversation "assisting merchant"
	# A mission with no destination will not be offered, so give it one.
	# What the destination is doesn't matter, because you always 'decline' this.
	destination "Earth"

mission "Assisting Merchant (Medium)"
	assisting
	repeat
	minor
	to offer
		random < 15
	source
		government "Merchant"
		category "Medium Warship" "Heavy Freighter"
		not attributes "automaton"
	on offer
		payment 20000
		conversation "assisting merchant"
	destination "Earth"

mission "Assisting Merchant (Large)"
	assisting
	repeat
	minor
	to offer
		random < 10
	source
		government "Merchant"
		category "Heavy Warship"
		not attributes "automaton"
	on offer
		payment 30000
		conversation "assisting merchant"
	destination "Earth"

phrase "assist merchant 1"
	phrase
		"assist merchant 1-1"
	phrase
		"assist merchant 1-2"
	phrase
		"assist merchant 1-3"

phrase "assist merchant 1 hazardous"
	phrase
		"assist merchant 1-1"
	phrase
		"assist merchant 1-2 hazardous"
	phrase
		"assist merchant 1-3"

phrase "assist merchant 1-1"
	word
		`<WR-0>`
		`<WR-1>`
		`<WR-2>`
		`<WR-3>`
		`<WR-4>`
		`<WR-5>`

phrase "assist merchant 1-2"
	word
		`<WR-6>`
		`<WR-7>`
		`<WR-8>`

phrase "assist merchant 1-2 hazardous"
	word
		`<WR-9>`
		`<WR-10>`
		`<WR-11>`
		`<WR-12>`
		`<WR-13>`

phrase "assist merchant 1-3"
	word
		`<WR-14>` 4
		`<WR-15>` 2
		`<WR-16>`
	word
		`<WR-17>`
		`<WR-18>`
		`<WR-19>`
		`<WR-20>`
		`<WR-21>`
		`<WR-22>`
	word
		`<WR-23>`

phrase "assist merchant 2"
	phrase
		`assist merchant 2 simple` 2
		`assist merchant 2 complex`

phrase "assist merchant 2 simple"
	word
		`<WR-24>`

phrase "assist merchant 2 complex"
	word
		`<WR-25>`
	word
		`<WR-26>`
		`<WR-27>`
		`<WR-28>`
		`<WR-29>`

phrase "assist merchant 3"
	word
		`<WR-30>`
		`<WR-31>`
		`<WR-32>`
		`<WR-33>`
	word
		`<WR-34>` 4
		`<WR-35>`
	word
		`<WR-36>`
	word
		`<WR-37>`
		`<WR-38>`
		`<WR-39>`

phrase "assist merchant 4"
	word
		`<WR-40>` 5
		`<WR-41>`
		`<WR-42>`
		`<WR-43>`
		`<WR-44>`
		`<WR-45>`
		`<WR-46>`



mission "Asteroid Course"
	assisting
	minor
	name "<NM-0>"
	description "<DS-0>"
	to offer
		random < 6
	source
		government "Merchant" "Syndicate"
		category "Light Freighter" "Interceptor"
		not attributes "automaton"
	passengers 3 7
	destination
		distance 1 3
		not government "Pirate"
		attributes shipyard
	on offer
		conversation
			`<CN-0>`
			branch unarmed
				not "armament deterrence"
			choice
				`<CN-1>`
					goto fire
				`<CN-2>`
					goto move
				`<CN-3>`
					goto repair
				`<CN-4>`
					goto escape
			label unarmed
			choice
				`<CN-2>`
					goto move
				`<CN-3>`
					goto repair
				`<CN-4>`
			label escape
			`<CN-5>`
				depart
			label fire
			branch success
				random < 50
			`<CN-6>`
				depart
			label success
			`<CN-7>`
				decline
			label repair
			branch crew
				random < 40
			`<CN-8>`
				depart
			label crew
			`<CN-9>`
			choice
				`<CN-10>`
					launch
				`<CN-11>`
			`<CN-12>`
				launch
			label move
			`<CN-13>`
				decline
	on decline
		payment 30000
	on complete
		payment
		payment 35000
		dialog "<DL-0>"



mission "Dangerous Journey"
	assisting
	minor
	name "<NM-1>"
	description "<DS-1>"
	to offer
		random < 10
	source
		government "Merchant"
		category "Light Freighter" "Heavy Freighter"
		not attributes "automaton"
	destination
		government "Republic" "Syndicate" "Free Worlds"
		attributes "frontier"
		distance 2 3
	cargo random 5 2 .1
	on offer
		conversation
			`<CN-14>`
			choice
				`<CN-15>`
					accept
				`<CN-16>`
			`<CN-17>`
				decline
	on complete
		payment 7500
		dialog `<DL-1>`



conversation "assisting law enforcement"
	`<CN-18>`
	`<CN-19>`
	choice
		`<CN-20>`
			decline
		`<CN-21>`
			accept

mission "Assisting Free Worlds"
	assisting
	repeat
	minor
	name "<NM-2>"
	description "<DS-2>"
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Free Worlds"
		not category "Fighter" "Drone"
		not attributes "automaton"
	destination
		government "Free Worlds"
		distance 2 4
	on offer
		conversation "assisting law enforcement"
	npc kill
		government "Pirate"
		personality heroic staying target harvests plunders
		system destination
		fleet "Large Southern Pirates" 2
		fleet "Small Southern Pirates"
	npc
		government "Free Worlds"
		personality heroic staying
		system destination
		fleet "Large Free Worlds"
	on complete
		payment 150000
		dialog phrase "generic pirate attack payment dialog"

mission "Assisting Republic"
	assisting
	repeat
	minor
	name "<NM-2>"
	description "<DS-2>"
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Republic"
		not category "Fighter" "Drone"
		not attributes "automaton"
	destination
		government "Republic"
		distance 2 4
	on offer
		conversation "assisting law enforcement"
	npc kill
		government "Pirate"
		personality heroic staying target harvests plunders
		system destination
		fleet "Large Northern Pirates" 2
		fleet "Small Northern Pirates"
	npc
		government "Republic"
		personality heroic staying
		system destination
		fleet "Small Republic" 2
	on complete
		payment 150000
		dialog phrase "generic pirate attack payment dialog"

mission "Assisting Deep Security"
	assisting
	repeat
	minor
	name "<NM-2>"
	description "<DS-2>"
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Deep Security"
		not category "Fighter" "Drone"
		not attributes "automaton"
	destination
		attributes "deep"
		distance 2 4
	on offer
		conversation "assisting law enforcement"
	npc kill
		government "Pirate"
		personality heroic staying target harvests plunders
		system destination
		fleet "Large Northern Pirates" 2
		fleet "Small Northern Pirates"
	npc
		government "Deep Security"
		personality heroic staying
		system destination
		fleet "Large Deep Security"
	on complete
		payment 150000
		dialog phrase "generic pirate attack payment dialog"

mission "Assisting Syndicate"
	assisting
	repeat
	minor
	name "<NM-2>"
	description "<DS-2>"
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Syndicate"
		not category "Fighter" "Drone"
		not attributes "automaton"
	destination
		government "Syndicate"
		distance 2 4
	on offer
		conversation "assisting law enforcement"
	npc kill
		government "Pirate"
		personality heroic staying target harvests plunders
		system destination
		fleet "Large Core Pirates" 2
		fleet "Small Core Pirates"
	npc
		government "Syndicate"
		personality heroic staying
		system destination
		fleet "Large Syndicate"
	on complete
		payment 150000
		dialog phrase "generic pirate attack payment dialog"



conversation "boarding pirate"
	`<CN-22>`
		decline

mission "Boarding Pirate (Small)"
	boarding
	repeat
	minor
	to offer
		random < 7
	source
		government "Pirate"
		category "Interceptor" "Light Warship" "Transport" "Light Freighter"
	on offer
		payment 50000
		conversation "boarding pirate"
	destination "Earth"

mission "Boarding Pirate (Medium)"
	boarding
	repeat
	minor
	to offer
		random < 5
	source
		government "Pirate"
		category "Medium Warship" "Heavy Freighter"
	on offer
		payment 100000
		conversation "boarding pirate"
	destination "Earth"

mission "Boarding Pirate (Large)"
	boarding
	repeat
	minor
	to offer
		random < 3
	source
		government "Pirate"
		category "Heavy Warship"
	on offer
		payment 150000
		conversation "boarding pirate"
	destination "Earth"



mission "Pirate Ambush"
	invisible
	boarding
	repeat
	minor
	deadline 1
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Pirate"
		category "Interceptor" "Light Warship" "Transport" "Light Freighter"
		not attributes "automaton"
	on offer
		conversation
			`<CN-23>`
				launch
	destination "Earth"
	npc kill
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "pirate raid" 2



mission "Pirate Mutiny"
	boarding
	minor
	description "<DS-3>"
	to offer
		random < 10
	source
		government "Pirate"
		category "Medium Warship" "Heavy Warship"
		not attributes "automaton"
	destination
		government "Republic" "Free Worlds" "Syndicate" "Neutral" "Independent"
		distance 2 4
	passengers 10 20
	on offer
		conversation
			`<CN-24>`
			`<CN-25>`
			choice
				`<CN-26>`
					launch
				`<CN-27>`
					flee
	on complete
		payment 25000
		dialog `<DL-2>`



mission "Slave Crew Rescue"
	invisible
	assisting
	deadline 1
	passengers 1
	to offer
		random < 10
	source
		government "Merchant"
		category "Heavy Freighter"
		not attributes "automaton"
	destination "Earth"
	on offer
		conversation
			branch "boarding alone" "boarding with a big boarding party"
				"flagship crew" < 3

			label "boarding alone"
			branch "flagship is empty" "first mate left on flagship"
				"flagship crew" == 1

			label "flagship is empty"
			`<CN-28>`
				goto "first decision"

			label "first mate left on flagship"
			`<CN-29>`
				goto "first decision"

			label "boarding with a big boarding party"
			`<CN-30>`

			label "first decision"
			choice
				`<CN-31>`
					accept
				`<CN-32>`
					goto probe
				`<CN-33>`
					goto "crew missing"
				`<CN-34>`
					goto "crew missing"

			label probe
			`<CN-35>`
				goto "get to work"

			label "crew missing"
			`<CN-36>`

			label "get to work"
			`<CN-37>`
			choice
				`<CN-38>`
					accept
				`<CN-39>`
			`<CN-40>`
			choice
				`<CN-41>`
					goto coward
				`<CN-42>`
					goto "trickster or monster"
				`<CN-43>`
					goto blackmailer
				`<CN-44>`
					goto "the direct approach"
				`<CN-45>`
					goto "attack but tarquin is prepared"

			label coward
			`<CN-46>`
			action
				set "tarquin hates you"
			`<CN-47>`
				accept

			label "trickster or monster"
			`<CN-48>`
			choice
				`<CN-49>`
					accept
				`<CN-50>`
					goto "attack with the element of surprise"

			label "attack with the element of surprise"
			branch "attack alone with the element of surprise" "attack with a big boarding party"
				"flagship crew" < 3

			label "attack but tarquin is prepared"
			branch "attack alone but tarquin is prepared" "attack with a big boarding party"
				"flagship crew" < 3

			label "attack alone with the element of surprise"
			`<CN-51>`
			branch "good luck" "bad luck"
				random < 80

			label "attack alone but tarquin is prepared"
			branch "good luck" "bad luck"
				random < 40

			label "attack with a big boarding party"
			`<CN-52>`
			choice
				`<CN-53>`
					goto execution
				`<CN-54>`
			branch "has brig"
				has "outfit (flagship installed): Brig"

			`<CN-55>`
			`<CN-56>`
			`<CN-57>`
			`<CN-58>`
			action
				set "tarquin hates you"
			`<CN-59>`
				launch

			label "has brig"
			`<CN-60>`
				goto "rescue the crew with tarquin captured"

			label execution
			`<CN-61>`
				goto "rescue the crew"

			label blackmailer
			branch "blackmailing alone" "blackmailing with a big boarding party"
				"flagship crew" < 3

			label "blackmailing with a big boarding party"
			`<CN-62>`
			action
				set "tarquin hates you"
			`<CN-47>`
				decline

			label "blackmailing alone"
			`<CN-63>`
				goto "attack alone but tarquin is prepared"

			label "the direct approach"
			branch "acting stupid alone" "attack with a big boarding party"
				"flagship crew" < 3

			label "acting stupid alone"
			`<CN-64>`
				die

			label "bad luck"
			`<CN-65>`
				die

			label "good luck"
			`<CN-66>`
				goto "rescue the crew"

			label "rescue the crew"
			`<CN-67>`
			`<CN-68>`
				accept

			label "rescue the crew with tarquin captured"
			`<CN-69>`
			action
				set "captured tarquin"
			`<CN-70>`
			`<CN-71>`
				accept

	on decline
		payment 1000000
	on accept
		payment 350000

mission "Turn in Tarquin"
	description "<DS-4>"
	passengers 1
	landing
	to offer
		has "captured tarquin"
	destination "Earth"
	on offer
		set "turned in tarquin"
		conversation
			"You haul captain Tarquin out of your brig and bring him to the portside police station, presenting evidence from your suit cameras and notarized witness statements compiled from your crew members attesting to his crimes of being involved in slavery. The officer on duty thanks you for the service you've rendered, and takes Tarquin into custody. He shoots one final black look at you that sends a shiver up your spine."
				decline

mission "Boarding Derelict"
	boarding
	repeat
	invisible
	deadline 3
	to complete
		never
	source
		government "Derelict (Boardable)"
	destination "Earth"
	npc
		government "Pirate"
		personality entering nemesis vindictive staying
		fleet "pirate raid" 2
	on offer
		conversation
			`<CN-72>`
			choice
				`<CN-73>`
					goto salvage
				`<CN-74>`
			`<CN-75>`
			choice
				`<CN-76>`
					goto engines
				`<CN-77>`
					goto hull
				`<CN-78>`
			branch powersurge
				random < 80
			`<CN-79>`
			choice
				`<CN-80>`
					goto engines(p)
				`<CN-81>`
					goto hull(p)
			label hull
			branch crumple
				random < 15
			`<CN-82>`
			choice
				`<CN-80>`
					goto engines(h)
				`<CN-83>`
					goto power(h)
			label hull(e)
			branch crumple
				random < 45
			`<CN-82>`
			choice
				`<CN-84>`
					goto power(eh)
				`<CN-85>`
					goto flee
			label hull(p)
			branch crumple
				random < 25
			`<CN-82>`
			choice
				`<CN-86>`
					goto engines(hp)
				`<CN-85>`
					goto flee
			label hull(ep)
			branch crumple
				random < 75
			`<CN-82>`
			`<CN-87>`
			branch fail
				random < 40
			`<CN-88>`
				goto success
			label engines
			branch misfire
				random < 60
			`<CN-89>`
			choice
				`<CN-81>`
					goto hull(e)
				`<CN-83>`
					goto power(e)
			label engines(h)
			branch misfire
				random < 60
			`<CN-89>`
			choice
				`<CN-84>`
					goto power(eh)
				`<CN-85>`
					goto flee
			label engines(p)
			`<CN-90>`
			choice
				`<CN-91>`
					goto hull(ep)
				`<CN-85>`
					goto flee
			label engines(hp)
			`<CN-90>`
			`<CN-87>`
			branch fail
				random < 5
			`<CN-88>`
				goto success
			label power(h)
			branch powersurge
				random < 5
			`<CN-79>`
			choice
				`<CN-86>`
					goto engines(hp)
				`<CN-85>`
					goto flee
			label power(e)
			branch powersurge
				random < 55
			`<CN-79>`
			choice
				`<CN-91>`
					goto hull(ep)
				`<CN-85>`
					goto flee
			label power(eh)
			branch powersurge
				random < 15
			`<CN-79>`
			`<CN-87>`
			branch fail
				random < 25
			`<CN-88>`
				goto success
			label powersurge
			`<CN-92>`
				depart
			label crumple
			`<CN-93>`
				depart
			label misfire
			`<CN-94>`
				depart
			label flee
			action
				payment 7500
			`<CN-95>`
			`<CN-96>`
				depart
			label fail
			`<CN-97>`
			choice
				`<CN-98>`
			`<CN-99>`
			choice
				`<CN-100>`
					goto run
				`<CN-101>`
					goto dive
				`<CN-102>`
			`<CN-103>`
				depart
			label run
			`<CN-104>`
				depart
			label dive
			`<CN-105>`
				depart
			label success
			branch beacon
				random < 15
			branch virus
				random < 5
				"credits" > 1000000
			action
				payment 65000
			`<CN-106>`
				decline
			label beacon
			`<CN-107>`
				launch
			label virus
			action
				payment -200000
			`<CN-108>`
			`<CN-109>`
				depart
			label salvage
			`<CN-110>`
			branch valuable
				random < 40
			action
				payment 10000
			`<CN-111>`
				goto detonate
			label valuable
			branch rare
				or
					and
						random < 25
						or
							not "derelict treasure map: ion cannons"
							not "derelict family investment"
					random < 5
			action
				payment 63000
			`<CN-112>`
				goto detonate
			label rare
			branch quest
				or
					not "derelict treasure map: ion cannons"
					not "derelict family investment"
			action
				payment 475000
			`<CN-113>`
				goto detonate
			label quest
			branch treasure
				not "derelict treasure map: ion cannons"
				or
					random < 50
					has "derelict family investment"
			action
				set "derelict family investment"
			`<CN-114>`
				goto detonate
			label treasure
			action
				set "derelict treasure map: ion cannons"
				payment 26500
			`<CN-115>`
				goto detonate
			label detonate
			choice
				`<CN-116>`
				`<CN-117>`
					goto continued
			`<CN-118>`
				depart
			label continued
			branch unlucky
				random < 75
			action
				payment 35000
			`<CN-119>`
			`<CN-120>`
				depart
			label unlucky
			branch pirate
				random < 20
			`<CN-121>`
			`<CN-120>`
				depart
			label pirate
			`<CN-122>`
				goto beacon
