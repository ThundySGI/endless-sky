# Copyright (c) 2014-2015 by Michael Zahniser
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.

mission "Kestrel Testing"
	name "<NM-378>"
	description "<DS-607>"
	source "Wayfarer"
	waypoint "Umbral"
	# The Kestrel is a secret that can only be unlocked after completing the rest of the game. Combat rating is used to track gameplay progression.
	# After finding the Kestrel once, the threshold is lowered so players can use the ship during the human campaign on a later playthrough.
	# Any requests to reduce the requirements will be rejected.
	to offer
		or
			"combat rating" > 6000
			and
				"combat rating" > 2000
				has "global: unlocked kestrel"
	
	on offer
		conversation
			`<CN-7754>`
			choice
				`<CN-4442>`
				`<CN-7755>`
					defer
			`<CN-7756>`
			choice
				`<CN-7757>`
					goto continue
				`<CN-7758>`
			`<CN-7759>`
				goto kestrel
			label continue
			`<CN-7760>`
			label kestrel
			`<CN-7761>`
			choice
				`<CN-7762>`
					goto test
				`<CN-7763>`
			`<CN-7764>`
			`<CN-7765>`
			label test
			`<CN-7766>`
			choice
				`<CN-7767>`
				`<CN-7768>`
					decline
			`<CN-7769>`
				accept
	
	npc disable save
		government "Test Dummy"
		personality disables staying nemesis heroic
		system "Umbral"
		ship "Unknown Ship Type" "Tarazed Prototype"
	
	on complete
		payment 2000000
		"global: unlocked kestrel" ++
		conversation
			`<CN-7770>`
			choice
				`<CN-7771>`
					goto yes
				`<CN-7772>`
					goto no
			
			label yes
			`<CN-7773>`
				goto changes
			
			label no
			`<CN-7774>`
				goto changes
			
			label changes
			choice
				`<CN-7775>`
					goto weapons
				`<CN-7776>`
					goto engines
				`<CN-7777>`
					goto shields
				`<CN-7778>`
					goto bays
			
			label weapons
			action
				set "kestrel: more weapons"
			`<CN-7779>`
				goto name
			
			label engines
			action
				set "kestrel: more engines"
			`<CN-7780>`
				goto name
			
			label shields
			action
				set "kestrel: more shields"
			`<CN-7781>`
				goto name
			
			label bays
			action
				set "kestrel: more bays"
			`<CN-7782>`
				goto name
			
			label name
			`<CN-7783>`
			`<CN-7784>`
			choice
				`<CN-7785>`
					goto wraith
				`<CN-7786>`
					goto goose
			
			label wraith
			`<CN-7787>`
			choice
				`<CN-7788>`
					goto wolf
				`<CN-7789>`
					goto kestrel
			
			label goose
			`<CN-7790>`
			choice
				`<CN-7791>`
					goto reaper
				`<CN-7789>`
					goto kestrel
			
			label wolf
			`<CN-7792>`
			choice
				`<CN-7786>`
					goto goose
				`<CN-7789>`
					goto kestrel
			
			label reaper
			`<CN-7793>`
			choice
				`<CN-7785>`
					goto wraith
				`<CN-7789>`
					goto kestrel
			
			label kestrel
			`<CN-7794>`



mission "Kestrel: More Weapons"
	landing
	invisible
	to offer
		has "kestrel: more weapons"
	on offer
		event "kestrel available: more weapons" 50
		fail



mission "Kestrel: More Engines"
	landing
	invisible
	to offer
		has "kestrel: more engines"
	on offer
		event "kestrel available: more engines" 50
		fail



mission "Kestrel: More Shields"
	landing
	invisible
	to offer
		has "kestrel: more shields"
	on offer
		event "kestrel available: more shields" 50
		fail



mission "Kestrel: More Bays"
	landing
	invisible
	to offer
		has "kestrel: more bays"
	on offer
		event "kestrel available: more bays" 50
		fail



mission "Kestrel Available"
	landing
	source
		near "Tarazed" 100
	to offer
		has "kestrel available"
	destination "Wayfarer"
	on offer
		conversation
			branch engines
				has "kestrel: more engines"
			
			branch shields
				has "kestrel: more shields"
			
			branch bays
				has "kestrel: more bays"
			
			scene "thumbnail/kestrelw"
			`<CN-307>`
				goto message
			
			label engines
			scene "thumbnail/kestrele"
			`<CN-307>`
				goto message
			
			label shields
			scene "thumbnail/kestrels"
			`<CN-307>`
				goto message
				
			label bays
			scene "thumbnail/kestrelc"
			`<CN-307>`
			label message
			`<CN-7795>`
				decline


shipyard "Kestrel"

event "kestrel available: more weapons"
	set "kestrel available"
	shipyard "Kestrel"
		"Kestrel (More Weapons)"
	planet Wayfarer
		add shipyard "Kestrel"
event "kestrel available: more engines"
	set "kestrel available"
	shipyard "Kestrel"
		"Kestrel (More Engines)"
	planet Wayfarer
		add shipyard "Kestrel"
event "kestrel available: more shields"
	set "kestrel available"
	shipyard "Kestrel"
		"Kestrel (More Shields)"
	planet Wayfarer
		add shipyard "Kestrel"
event "kestrel available: more bays"
	set "kestrel available"
	shipyard "Kestrel"
		"Kestrel (More Bays)"
	planet Wayfarer
		add shipyard "Kestrel"


ship "Unknown Ship Type"
	sprite "ship/kestrel"
	thumbnail "thumbnail/kestrel"
	attributes
		category "Heavy Warship"
		"cost" 14700000
		"shields" 19400
		"hull" 7200
		"required crew" 64
		"bunks" 128
		"mass" 2135
		"drag" 20.9
		"heat dissipation" .32
		"fuel capacity" 500
		"cargo space" 120
		"outfit space" 810
		"weapon capacity" 390
		"engine capacity" 210
		weapon
			"blast radius" 260
			"shield damage" 2600
			"hull damage" 1300
			"hit force" 3900
	outfits
		"Particle Cannon" 4
		"Torpedo Launcher" 2
		"Torpedo" 60
		"Heavy Laser Turret" 4
		
		"Fusion Reactor"
		"LP144a Battery Pack"
		"D94-YV Shield Generator"
		"Liquid Nitrogen Cooler"
		"Tactical Scanner" 2
		
		"Orca Plasma Thruster"
		"Orca Plasma Steering"
		"Hyperdrive"
	engine 13 170
	engine -13 170
	gun -73.5 46 "Torpedo Launcher"
	gun 73.5 46 "Torpedo Launcher"
	gun -51 49.5 "Particle Cannon"
	gun 51 49.5 "Particle Cannon"
	gun -29.5 52 "Particle Cannon"
	gun 29.5 52 "Particle Cannon"
	turret -8 -10.5 "Heavy Laser Turret"
	turret 8 -10.5 "Heavy Laser Turret"
	turret -20.5 9 "Heavy Laser Turret"
	turret 20.5 9 "Heavy Laser Turret"
	explode "small explosion" 25
	explode "medium explosion" 35
	explode "large explosion" 45
	explode "huge explosion" 30
	"final explode" "final explosion large"


ship "Kestrel"
	sprite "ship/kestrel"
	thumbnail "thumbnail/kestrel"
	attributes
		category "Heavy Warship"
		"cost" 14700000
		"shields" 19400
		"hull" 7200
		"required crew" 64
		"bunks" 128
		"mass" 2135
		"drag" 20.9
		"heat dissipation" .32
		"fuel capacity" 500
		"cargo space" 120
		"outfit space" 810
		"weapon capacity" 390
		"engine capacity" 210
		weapon
			"blast radius" 260
			"shield damage" 2600
			"hull damage" 1300
			"hit force" 3900
	outfits
		"Particle Cannon" 4
		"Torpedo Launcher" 2
		"Torpedo" 60
		"Heavy Laser Turret" 4
		
		"Fusion Reactor"
		"LP144a Battery Pack"
		"D94-YV Shield Generator"
		"Liquid Nitrogen Cooler"
		"Tactical Scanner" 2
		
		"Orca Plasma Thruster"
		"Orca Plasma Steering"
		"Hyperdrive"
	engine 13 170
	engine -13 170
	gun -73.5 46 "Torpedo Launcher"
	gun 73.5 46 "Torpedo Launcher"
	gun -51 49.5 "Particle Cannon"
	gun 51 49.5 "Particle Cannon"
	gun -29.5 52 "Particle Cannon"
	gun 29.5 52 "Particle Cannon"
	turret -8 -10.5 "Heavy Laser Turret"
	turret 8 -10.5 "Heavy Laser Turret"
	turret -20.5 9 "Heavy Laser Turret"
	turret 20.5 9 "Heavy Laser Turret"
	bay "Fighter" -46 106 under
		"launch effect" "human internal"
	bay "Fighter" 46 106 under
		"launch effect" "human internal"
	explode "small explosion" 25
	explode "medium explosion" 35
	explode "large explosion" 45
	explode "huge explosion" 30
	"final explode" "final explosion large"
	description "<DS-608>"


ship "Kestrel" "Kestrel (More Engines)"
	sprite "ship/kestrele"
	thumbnail "thumbnail/kestrele"
	add attributes
		"drag" -1.9
		"fuel capacity" 100
		"engine capacity" 30
	engine 13 170
	engine -13 170
	engine 24.5 160 0.4
	engine -24.5 160 0.4

ship "Kestrel" "Kestrel (More Shields)"
	sprite "ship/kestrels"
	thumbnail "thumbnail/kestrels"
	add attributes
		"shields" 3000
		"hull" 1500
		"heat dissipation" .032

ship "Kestrel" "Kestrel (More Weapons)"
	sprite "ship/kestrelw"
	thumbnail "thumbnail/kestrelw"
	add attributes
		"weapon capacity" 40
	gun -76.5 49
	gun 76.5 49
	gun -73.5 46 "Torpedo Launcher"
	gun 73.5 46 "Torpedo Launcher"
	gun -55.5 52.5
	gun 55.5 52.5
	gun -51 49.5 "Particle Cannon"
	gun 51 49.5 "Particle Cannon"
	gun -33 55
	gun 33 55
	gun -29.5 52 "Particle Cannon"
	gun 29.5 52 "Particle Cannon"
	turret -8 -10.5 "Heavy Laser Turret"
	turret 8 -10.5 "Heavy Laser Turret"
	turret -20.5 9 "Heavy Laser Turret"
	turret 20.5 9 "Heavy Laser Turret"

ship "Kestrel" "Kestrel (More Bays)"
	sprite "ship/kestrelc"
	thumbnail "thumbnail/kestrelc"
	add attributes
		"mass" 60
		"weapon capacity" -20
	outfits
		"Particle Cannon" 2
		"Torpedo Launcher" 2
		"Torpedo" 60
		"Heavy Laser Turret" 4
		
		"Fusion Reactor"
		"LP144a Battery Pack"
		"D94-YV Shield Generator"
		"Liquid Nitrogen Cooler"
		"Tactical Scanner" 2
		
		"Orca Plasma Thruster"
		"Orca Plasma Steering"
		"Hyperdrive"
	gun -73.5 46 "Torpedo Launcher"
	gun 73.5 46 "Torpedo Launcher"
	gun -29.5 52 "Particle Cannon"
	gun 29.5 52 "Particle Cannon"
	turret -8 -10.5 "Heavy Laser Turret"
	turret 8 -10.5 "Heavy Laser Turret"
	turret -20.5 9 "Heavy Laser Turret"
	turret 20.5 9 "Heavy Laser Turret"
	bay "Fighter" -46 106
		"launch effect" "human internal"
	bay "Fighter" 46 106
		"launch effect" "human internal"
	bay "Fighter" -62 78
		"launch effect" "human internal"
	bay "Fighter" 62 78
		"launch effect" "human internal"
	bay "Fighter" -56 70
		"launch effect" "human internal"
	bay "Fighter" 56 70
		"launch effect" "human internal"
