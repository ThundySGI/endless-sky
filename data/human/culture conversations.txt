# Copyright (c) 2021 by Michael Zahniser
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.

mission "Sad Gamblers - Republic"
	minor
	source
		government "Republic"
		attributes "near earth"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-168>`
			`<CN-169>`
				decline

mission "Sad Gamblers - Syndicate"
	minor
	source
		government "Syndicate"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-168>`
			`<CN-169>`
				decline



mission "Foiled Kidnapping Witnessed"
	minor
	source
		government "Syndicate"
		not attributes "station" "frontier" "urban"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-170>`
			`<CN-171>`
				decline



mission "Gift Store Interaction"
	minor
	source
		government "Republic"
		attributes "deep"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-172>`
			`<CN-173>`
			branch broke
				credits < 50
			`<CN-174>`
			choice
				`<CN-175>`
					goto buy
				`<CN-176>`
			`<CN-177>`
				decline
			
			label buy
			action
				payment -50
				outfit "Mug"
			`<CN-178>`
				decline
			
			label broke
			`<CN-179>`
				decline



mission "New China Mourners"
	minor
	source "New China"
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-180>`
			`<CN-181>`
				decline



mission "New Holland Foibles"
	minor
	source "New Holland"
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-182>`
			`<CN-183>`
			`<CN-184>`
			choice
				`<CN-185>`
				`<CN-186>`
					goto leave
			`<CN-187>`
			choice
				`<CN-188>`
				`<CN-186>`
					goto leave
			`<CN-189>`
			`<CN-190>`
				decline
			label leave
			`<CN-191>`
				decline



mission "Trash Fire Crops"
	minor
	source
		government "Republic"
		attributes "dirt belt"
		attributes "farming"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		"bumper crop year" = "year"
		conversation
			`<CN-192>`
			choice
				`<CN-193>`
					goto ignore
				`<CN-194>`
			`<CN-195>`
				decline
			label ignore
			`<CN-196>`
				decline



mission "Worker's Occasion"
	minor
	source
		government "Republic"
		attributes "dirt belt"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-197>`
			choice
				`<CN-198>`
					goto aid
				`<CN-199>`
					goto pity
				`<CN-200>`
			`<CN-201>`
				decline
			label aid
			`<CN-202>`
			`<CN-203>`
				decline
			label pity
			`<CN-204>`
				decline



mission "Paradise Cleaner Incident"
	minor
	source
		government "Republic"
		attributes "paradise"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-205>`
			`<CN-206>`
			`<CN-207>`
				decline



mission "Curious Waiter"
	minor
	source
		government "Syndicate"
		attributes "factory"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-208>`
			`<CN-209>`
			choice
				`<CN-210>`
				`<CN-211>`
				`<CN-212>`
			`<CN-213>`
			choice
				`<CN-214>`
				`<CN-215>`
				`<CN-216>`
			`<CN-217>`
			`<CN-218>`
				decline



mission "Syndicated Security Troops"
	minor
	source
		government "Syndicate"
		attributes "urban"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-219>`
			`<CN-220>`
				decline



mission "Class Trip to Port"
	minor
	source
		attributes "south"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-221>`
				decline



mission "Old Defense Turrets"
	minor
	source
		attributes "south"
		not attributes "station" "frontier"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-222>`
			`<CN-223>`
				decline



mission "Blind Landing"
	minor
	landing
	source
		government "Free Worlds"
		attributes "farming"
		not attributes "station" "frontier"
	"offer precedence" 5
	to offer
		"year" > "bumper crop year" + 2
		random < 1
		has "Trash Fire Crops: declined"
	on offer
		conversation
			`<CN-224>`
			choice
				`<CN-225>`
				`<CN-226>`
					goto orbit
			`<CN-227>`
			`<CN-228>`
			`<CN-229>`
				decline
			label orbit
			`<CN-230>`
				flee



mission "Forest Fire"
	minor
	source
		government "Free Worlds"
		attributes "frontier"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-231>`
			choice
				`<CN-232>`
					goto help
				`<CN-233>`
			`<CN-234>`
			choice
				`<CN-235>`
			`<CN-236>`
				goto fight
			label help
			`<CN-237>`
			choice
				`<CN-238>`
			label fight
			`<CN-239>`
			`<CN-240>`
			`<CN-241>`
				decline



mission "Local Politics"
	minor
	source
		attributes "frontier"
		attributes "south"
		not attributes "station" "urban" "ex-pirate"
	"offer precedence" 5
	to offer
		or
			and
				random < 5
				or
					has "flagship planet attribute: south pirate"
					not "event: war begins"
			and
				random < 1
				has "event: war begins"
				not "event: fw suppressed Greenrock"
	on offer
		conversation
			`<CN-242>`
			`<CN-243>`
				decline



mission "Military Response Test"
	landing
	minor
	source
		government "Free Worlds"
		not attributes "station" "urban" "frontier"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-244>`
			`<CN-245>`
			`<CN-246>`
				decline



mission "Missed Mugging"
	minor
	source
		government "Free Worlds"
		not attributes "station" "frontier"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-247>`
			`<CN-248>`
				decline



mission "Sojourn Sunday Sales"
	minor
	source
		government "Free Worlds"
		attributes "urban"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-249>`
				decline



mission "Tarazed Ship Christening"
	minor
	source "Wayfarer"
	to offer
		random < 10
		has "main plot completed"
	"offer precedence" 5
	on offer
		conversation
			`<CN-250>`
			choice
				`<CN-251>`
					goto investigate
				`<CN-252>`
					goto "pass by"
				`<CN-253>`
			`<CN-254>`
				decline
			label "pass by"
			`<CN-255>`
				decline
			label investigate
			`<CN-256>`
			`<CN-257>`
			`<CN-258>`
			choice
				`<CN-259>`
					goto plans
				`<CN-260>`
					goto advice
				`<CN-261>`
			`<CN-262>`
			`<CN-263>`
			choice
				`<CN-264>`
				`<CN-265>`
					goto "get out"
			`<CN-266>`
			`<CN-267>`
			label "get out"
			`<CN-268>`
			`<CN-269>`
				decline
			label plans
			`<CN-270>`
			label advice
			`<CN-271>`
			`<CN-272>`
			`<CN-273>`
			`<CN-274>`
			`<CN-275>`
			`<CN-276>`
				decline



mission "Masquerade Hanging"
	minor
	source
		government "Pirate"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-277>`
			`<CN-278>`
				decline

mission "News Reporter - Paradise"
	minor
	source
		government "Republic"
		attributes "paradise"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 8
		has "event: war begins"
		not "event: joined the free worlds"
	on offer
		conversation
			`<CN-279>`
			choice
				`<CN-280>`
					goto walk
				`<CN-281>`
					goto notice
				`<CN-282>`
			`<CN-283>`
				goto walk
			label notice
			`<CN-284>`
			label walk
			`<CN-285>`
			choice
				`<CN-286>`
					goto questions
				`<CN-287>`
					decline
			label questions
			`<CN-288>`
			`<CN-289>`
			choice
				`<CN-290>`
				`<CN-291>`
					goto right
			`<CN-292>`
			choice
				`<CN-293>`
				`<CN-294>`
				`<CN-295>`
				`<CN-296>`
			`<CN-297>`
			`<CN-298>`
				decline
			label right
			`<CN-299>`
			choice
				`<CN-300>`
				`<CN-301>`
				`<CN-296>`
			`<CN-302>`
			`<CN-298>`
				decline

mission "Scientists at the Pub after a Conference"
	minor
	source
		government "Republic"
		attributes "urban"
		not attributes "station"
	"offer precedence" 5
	to offer
		random < 1
	on offer
		conversation
			`<CN-303>`
			choice
				`<CN-304>`
					goto "overheard scientists 1"
				`<CN-305>`
					decline
			label "overheard scientists 1"
			`<CN-306>`
			`<CN-307>`
			`<CN-308>`
			`<CN-309>`
			`<CN-310>`
			`<CN-311>`
			`<CN-312>`
			`<CN-307>`
			`<CN-313>`
			`<CN-307>`
			`<CN-314>`
			choice
				`<CN-315>`
					goto "overheard scientists 2"
				`<CN-316>`
					decline
			label "overheard scientists 2"
			`<CN-317>`
			`<CN-318>`
			`<CN-307>`
			`<CN-319>`
			`<CN-307>`
			`<CN-320>`
			`<CN-321>`
			`<CN-307>`
			`<CN-322>`
			`<CN-323>`
			`<CN-324>`
			choice
				`<CN-325>`
					goto "overheard scientists 3"
				`<CN-326>`
					decline
			label "overheard scientists 3"
			`<CN-327>`
			`<CN-328>`
			`<CN-307>`
			`<CN-329>`
			`<CN-330>`
				decline


mission "Sol-Bound Shuttle"
	minor
	source
		system "Sol"
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-331>`
			choice
				`<CN-332>`
				`<CN-333>`
				`<CN-334>`
					decline
			`<CN-335>`
			choice
				`<CN-336>`
					goto boring
				`<CN-337>`
			`<CN-338>`
				goto end
			label boring
			`<CN-339>`
			label end
			`<CN-340>`
				decline

# Note about Earth Day and Earth Hour:
# Earth Day (in 2023) is a day of awareness about climate change and occurs every 22nd of April. Earth Hour is an hour
# of blackout around cities worldwide, also to bring awareness to climate change, and it's observed on the last Saturday
# of March.

# Since Earth Day has become a quasi-'national day' for Earthlings in Endless Sky, it would be interesting to have Earth
# Hour be conflated with Earth Day as well, to demonstrate how people in a thousand years' time observe what we observe
# today and how its meaning has changed.
mission "Earth Day Blackout"
	minor
	landing
	source "Earth"
	"offer precedence" 5
	to offer
		day == 22
		month == 4
	on offer
		conversation
			`<CN-341>`
			`<CN-342>`
			choice
				`<CN-343>`
				`<CN-344>`
					goto pass
			branch attendant tourist
				random > 50

			label attendant
			`<CN-345>`
			choice
				`<CN-346>`
				`<CN-347>`
			`<CN-348>`
			choice
				`<CN-349>`
				`<CN-350>`
					goto pass
			`<CN-351>`
			`<CN-352>`
				decline

			label tourist
			`<CN-353>`
			choice
				`<CN-354>`
				`<CN-355>`
					goto "way in"
			`<CN-356>`
			choice
				`<CN-357>`
				`<CN-358>`
			`<CN-359>`
				goto decided

			label "way in"
			`<CN-360>`

			label decided
			`<CN-361>`
			choice
				`<CN-362>`
				`<CN-363>`
					goto pass
			`<CN-364>`
			`<CN-365>`
				decline

			label pass
			`<CN-366>`
				decline

mission "Burthen Triathlon"
	minor
	source
		planet "Burthen"
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-367>`
			choice
				`<CN-368>`
				`<CN-369>`
					decline
			`<CN-370>`
			choice
				`<CN-371>`
				`<CN-372>`
					goto outside
				`<CN-373>`
					decline

			`<CN-374>`
			`<CN-375>`
			branch "no credits"
				credits < 2
			choice
				`<CN-376>`
				`<CN-377>`
					goto antigrav
					to display
						credits >= 30
				`<CN-378>`
					goto "leave tent"

			action
				payment -2
			`<CN-379>`
				goto "leave tent"

			label antigrav
			action
				payment -30
				outfit "Antigrav Glass"
			`<CN-380>`
				goto "leave tent"

			label "no credits"
			`<CN-381>`
			choice
				`<CN-382>`

			label "leave tent"
			`<CN-383>`
				goto "after tent"

			label outside
			`<CN-384>`
			`<CN-385>`
				goto end

			label "after tent"
			`<CN-386>`

			label "end"
			`<CN-387>`
				decline

mission "CCOR Guerrilla Standoff"
	minor
	source "Gagarin"
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-388>`
			`<CN-389>`
			choice
				`<CN-390>`
				`<CN-334>`
					decline
			`<CN-391>`
			`<CN-392>`
			choice
				`<CN-393>`
				`<CN-394>`
					decline
			`<CN-395>`
			`<CN-396>`
			`<CN-397>`
			`<CN-398>`
			`<CN-399>`
			`<CN-400>`
			`<CN-401>`
			`<CN-402>`
			`<CN-403>`

mission "Raider returning to Mordente-Bridi"
	source "Mordente-Bridi"
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-404>`
			`<CN-405>`
			`<CN-406>`

mission "Militia returning to Solace"
	source "Solace"
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-407>`
			`<CN-408>`
			`<CN-409>`

mission "Republic 300 Year Anniversary"
	landing
	source
		government "Republic"
		not attributes "uninhabited"
	"offer precedence" 5
	to offer
		year == 3030
	on offer
		conversation
			`<CN-410>`
			`<CN-411>`
			branch "war over"
				has "main plot completed"
			branch "war ongoing"
				has "chosen sides"
				not "main plot completed"
			`<CN-412>`
				goto end
			label "war ongoing"
			`<CN-413>`
				goto end
			label "war over"
			`<CN-414>`
			branch "zenith bombed"
				has "Wanderers: Sestor: Return to Wanderers: done"
			branch "sestor beaten at farpoint" end
				has "Wanderers: Sestor Alt: Return to Wanderers: done"
			label "zenith bombed"
			`<CN-415>`
				goto end
			label "sestor beaten at farpoint"
			`<CN-416>`
			label end
			choice
				`<CN-417>`
					goto celebrate
				`<CN-418>`
			`<CN-419>`
				decline
			label celebrate
			`<CN-420>`
				decline

mission "Exotic Life: Buccaneer Bay"
	minor
	source "Buccaneer Bay"
	"offer precedence" 5
	to offer
		random < 10
		credits > 379
	on offer
		conversation
			`<CN-421>`
			`<CN-422>`
			choice
				`<CN-423>`
				`<CN-424>`
					goto price
				`<CN-425>`
					decline
			`<CN-426>`
			label price
			`<CN-427>`
			choice
				`<CN-428>`
				`<CN-425>`
					decline
			action
				payment -379
			`<CN-429>`
			`<CN-430>`
			`<CN-307>`
			`<CN-431>`
			`<CN-432>`
			`<CN-433>`
			`<CN-434>`
			`<CN-435>`
			`<CN-436>`
			`<CN-437>`
			choice
				`<CN-438>`
				`<CN-439>`
					goto thanks
			`<CN-440>`
			label thanks
			`<CN-441>`
				decline

mission "Exotic Life: Delve"
	minor
	source Delve
	"offer precedence" 5
	to offer
		random < 20
	on offer
		conversation
			`<CN-442>`
			choice
				`<CN-443>`
				`<CN-444>`
					decline
				`<CN-445>`
					to display
						has "exotic animals: delvan shipworm known"
					goto known
			`<CN-446>`
			`<CN-447>`
			`<CN-448>`
			`<CN-449>`
			`<CN-450>`
			action
				set "exotic animals: delvan shipworm known"
			`<CN-451>`
				goto ending
			label known
			`<CN-452>`
			`<CN-453>`
			`<CN-454>`
			`<CN-455>`
			label ending
			`<CN-456>`
				decline

mission "Exotic Life: Ada"
	minor
	source Ada
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-457>`
			`<CN-458>`
			choice
				`<CN-459>`
				`<CN-444>`
					decline
				`<CN-460>`
					to display
						has "exotic animals: delvan shipworm known"
					goto known
			`<CN-461>`
			choice
				`<CN-462>`
				`<CN-463>`
					to display
						has "exotic animals: delvan shipworm known"
					goto known
				`<CN-464>`
					decline
			`<CN-465>`
			`<CN-466>`
			`<CN-467>`
			`<CN-468>`
			`<CN-469>`
			`<CN-470>`
			`<CN-471>`
			action
				set "exotic animals: delvan shipworm known"
			`<CN-472>`
				goto ending
			label known
			`<CN-473>`
			`<CN-474>`
			`<CN-475>`
			`<CN-476>`
			`<CN-477>`
			label ending
			`<CN-478>`

mission "Exotic Life: Glaze"
	repeat
	minor
	source Glaze
	"offer precedence" 5
	to offer
		random < 10
		or
			not "chosen sides"
			has "main plot completed"
		not "exotic life: seen glaze apes"
	on offer
		conversation
			`<CN-479>`
			`<CN-480>`
			choice
				`<CN-481>`
					to display
						credits >= 1
				`<CN-482>`
					to display
						credits >= 1
					decline
				`<CN-483>`
					to display
						credits < 1
					decline
			action
				payment -1
			branch "no rare apes"
				random < 20
			`<CN-484>`
			`<CN-485>`
			action
				set "exotic life: seen glaze apes"
			`<CN-486>`
				decline
			label "no rare apes"
			`<CN-487>`
			`<CN-488>`
				decline

mission "Exotic Life: Bluestone"
	minor
	source Bluestone
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-489>`
			`<CN-490>`
			`<CN-491>`
			choice
				`<CN-492>`
				`<CN-493>`
					decline
			`<CN-494>`
			`<CN-495>`
			`<CN-496>`
			`<CN-497>`
			`<CN-498>`
			`<CN-499>`
			`<CN-500>`
			choice
				`<CN-501>`
					goto "once wrong"
				`<CN-502>`
					goto "once wrong"
				`<CN-503>`
					goto "once right"
				`<CN-504>`
				`<CN-505>`
					goto awkward
			`<CN-506>`
			label "once wrong"
			`<CN-507>`
				goto chlorophyll
			label "once right"
			`<CN-508>`
				goto chlorophyll
			label awkward
			`<CN-509>`
			label chlorophyll
			`<CN-510>`
			`<CN-511>`
			choice
				`<CN-512>`
					goto "twice right"
				`<CN-513>`
					goto "twice wrong"
				`<CN-514>`
				`<CN-515>`
					goto "twice shy"
			`<CN-516>`
			label "twice wrong"
			`<CN-517>`
				goto "native plants"
			label "twice right"
			`<CN-518>`
				goto "native plants"
			label "twice shy"
			`<CN-519>`
			label "native plants"
			`<CN-520>`
			`<CN-521>`
			`<CN-522>`
			`<CN-523>`
			choice
				`<CN-524>`
				`<CN-525>`
					goto silence
			`<CN-526>`
				goto ending
			label silence
			`<CN-527>`
			label ending
			`<CN-528>`
				decline

mission "Exotic Life: Geyser"
	minor
	source Geyser
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-529>`
			`<CN-530>`
			choice
				`<CN-531>`
					goto argue
				`<CN-532>`
			`<CN-533>`
				decline
			label argue
			`<CN-534>`
			choice
				`<CN-535>`
				`<CN-536>`
			`<CN-537>`
				decline

mission "Exotic Life: Bloodsea"
	minor
	source Bloodsea
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			branch "former pirates"
				or
					has "event: bloodsea independent"
					has "event: bloodsea joins free worlds"
			`<CN-538>`
				goto "rest of hello"
			label "former pirates"
			`<CN-539>`
			label "rest of hello"
			`<CN-540>`
			choice
				`<CN-541>`
				`<CN-542>`
					goto declined
			`<CN-543>`
			`<CN-544>`
			`<CN-545>`
			choice
				`<CN-546>`
					to display
						credits > 80000
				`<CN-547>`
					to display
						credits > 8000
					goto thousand
				`<CN-548>`
					to display
						credits > 800
					goto hundred
				`<CN-549>`
					goto declined
			action
				payment -80000
				"reputation: Pirate" += 1
			`<CN-550>`
				decline
			label thousand
			action
				payment -8000
			`<CN-551>`
				decline
			label hundred
			action
				payment -800
			`<CN-552>`
				decline
			label declined
			`<CN-553>`
				decline

mission "Exotic Life: Albatross"
	minor
	source Albatross
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-554>`
			label "next question"
			choice
				`<CN-555>`
					goto implants
					to display
						not "heard implants"
				`<CN-556>`
					goto badgers
					to display
						not "heard badgers"
				`<CN-557>`
					to display
						has "heard badgers"
						not "heard turnips"
					goto turnips
				`	"The sign says 'No ${plural nouns}'?"`
					goto "mad lib"
					to display
						or
							has "heard implants"
							has "heard turnips"
							has "heard weasels"
						not "heard madlib"
				`<CN-558>`
					goto weasels
					to display
						not "heard weasels"
				`<CN-559>`
					goto polecats
					to display
						has "heard weasels"
						not "heard polecats"
				`<CN-560>`
					goto albatross
					to display
						has "heard polecats"
				`<CN-561>`
					goto ending
					to display
						or
							has "heard implants"
							has "heard badgers"
							has "heard weasels"
				`<CN-562>`
					goto ending
					to display
						not "heard implants"
						not "heard badgers"
						not "heard weasels"
			label implants
			action
				set "heard implants"
			`<CN-563>`
				goto "next question"
			label badgers
			action
				set "heard badgers"
			`<CN-564>`
				goto "next question"
			label turnips
			action
				set "heard turnips"
			`<CN-565>`
				goto "next question"
			label "mad lib"
			action
				set "heard madlib"
			`	His lips curl into a bitter snarl as he spills a flood of exasperation, "They cause ${pirate adjectives that work as titles}, ${pirate adjectives that work as titles}, ${pirate adjectives that work as titles} ${bad outcomes}!"`
			`<CN-566>`
				goto "next question"
			label weasels
			action
				set "heard weasels"
			`<CN-567>`
				goto "next question"
			label polecats
			action
				set "heard polecats"
			`<CN-568>`
				goto "next question"
			label albatross
			`<CN-569>`
			`<CN-570>`
			label ending
			action
				clear "heard implants"
				clear "heard badgers"
				clear "heard turnips"
				clear "heard madlib"
				clear "heard weasels"
				clear "heard polecats"

mission "Exotic Life: New Greenland"
	minor
	source "New Greenland"
	to offer
		random < 10
	on offer
		conversation
			`<CN-571>`
			`<CN-572>`
			`<CN-573>`
			choice
				`<CN-574>`
				`<CN-575>`
					goto ending
				`<CN-576>`
					decline
			`<CN-577>`
			label ending
			`<CN-578>`
				decline

mission "Exotic Life: Mainsail"
	minor
	source Mainsail
	to offer
		random < 10
	on offer
		conversation
			`<CN-579>`
			`<CN-580>`
			choice
				`<CN-581>`
				`<CN-582>`
				`<CN-583>`
					goto seen
				`<CN-576>`
					decline
			action
				set "exotic animals: mainsail seadog known"
			`<CN-584>`
				goto ending
			label seen
			`<CN-585>`
			label ending
			`<CN-586>`
				decline

mission "Little Vienna in New Austria"
	minor
	source "New Austria"
	"offer precedence" 5
	to offer
		random < 10
	on offer
		conversation
			`<CN-587>`
			choice
				`<CN-588>`
				`<CN-589>`
					decline
			`<CN-590>`
			`<CN-591>`
			`<CN-592>`
			`<CN-593>`
			choice
				`<CN-594>`
				`<CN-595>`
					goto declined
			`<CN-596>`
			`<CN-597>`
			`<CN-598>`
			`<CN-599>`
				goto backtoship
			label declined
			`<CN-600>`
			label backtoship
			`<CN-601>`

mission "Struggling Author Gone Missing"
	minor
	landing
	source "Zug"
	to offer
		random < 88
		has "event: beyond the hyperdrive is published"
	on offer
		conversation
			`<CN-602>`
			`<CN-603>`
			choice
				`<CN-604>`
				`<CN-605>`
					goto continue
			`<CN-606>`
			label continue
			`<CN-607>`
			`<CN-608>`
			`<CN-609>`
				decline

phrase "racetrack"
	word
		"<WR-47>"
		"<WR-48>"
		"<WR-49>"
		"<WR-50>"
		"<WR-51>"
		"<WR-52>"
		"<WR-53>"
		"<WR-54>"
		"<WR-55>"

phrase "sunracer opening"
	word
		"<WR-56>"
		"<WR-57>"
		"<WR-58>"
		"<WR-59>"
		"<WR-60>"

phrase "sunracer hovercraft adhook"
	word
		"<WR-61>"
		"<WR-62>"
		"<WR-63>"
	word
		"<WR-64>"
		"<WR-65>"
		"<WR-66>"

phrase "sunracer hovercraft adcloser"
	word
		"<WR-67>"
		"<WR-68>"
		"<WR-69>"
	word
		"<WR-70>"
		"<WR-71>"
	word
		"<WR-72>"
		"<WR-73>"
		"<WR-74>"
	word
		"<WR-75>"
		"<WR-76>"
		"<WR-77>"
	word
		"<WR-78>"
		"<WR-79>"
		"<WR-80>"
		"<WR-81>"
		"<WR-82>"
		`<WR-83>`
	replace
		"<WR-84>" 		"<WR-85>" 		"<WR-86>" 		"<WR-87>" 		"<WR-88>" 		"<WR-89>" 		
phrase "sunracer city to wilderness description"
	word
		"<WR-90>"
		"<WR-91>"
		"<WR-92>"
	word
		"<WR-93>"
		"<WR-94>"
		"<WR-95>"
	word
		"<WR-96>"
		"<WR-97>"
		"<WR-98>"

phrase "sunracer fan tshirt"
	word
		"<WR-99>"
		"<WR-100>"
		`<WR-101>`
		`<WR-102>`
		`<WR-103>`
		`<WR-104>`
	word
		"<WR-105>"
	word
		"<WR-106>"
		"<WR-107>"
		"<WR-108>"
		

phrase "sunracer hovercraft race description"
	word
		"<WR-109>"
		"<WR-110>"
		"<WR-111>"
		"<WR-112>"
	word
		"<WR-113>"
		"<WR-114>"
		"<WR-115>"
		"<WR-116>"
	word
		"<WR-117>"
	word
		"<WR-118>"
		"<WR-119>"
		"<WR-120>"
		"<WR-121>"
	word
		"<WR-122>"
		"<WR-123>"
		"<WR-124>"
		"<WR-125>"
	word
		"<WR-117>"
	word
		"<WR-126>"
		"<WR-127>"
		`<WR-128>`
		"<WR-129>"
	word
		"<WR-130>"
		"<WR-131>"
	word
		"<WR-132>"
		"<WR-133>"
		"<WR-134>"
		"<WR-135>"
	word
		"<WR-117>"
	word
		"<WR-136>"
		"<WR-137>"
		"<WR-138>"
	word
		"<WR-139>"
		"<WR-140>"
		"<WR-141>"
		"<WR-142>"

phrase "sunracer hovercraft victory description"
	word
		"<WR-143>"
		"<WR-144>"
		"<WR-145>"

phrase "sunracer hovercraft victory exit"
	word
		"<WR-146>"
		"<WR-147>"
		"<WR-148>"
		"<WR-149>"

mission "A Sunracer Hovercraft Racing"
	minor
	repeat
	invisible
	"offer precedence" 10
	to offer
		random < 40
	source "Sunracer"
	substitutions
		"<racename>" "${adjectives} ${racetrack}"
		"<megaparsec name>" "${civilian}"
		"<syndicate name>" "${syndicate fighter}"
		"<delta name>" "${free worlds fighter}"
		"<deep name>" "${deep fighter}"
	on offer
		conversation
			`${sunracer opening}, a ${sunracer hovercraft adhook}: there's a hovercraft race at the <racename>, just a few hours away by hover rail, or much faster aboard a <model>. ${sunracer hovercraft adcloser}`
			choice
				`<CN-610>`
				`<CN-611>`
					decline
			action
				"race length" = 3 + "roll: 2"
				"syndicate boost" = 2 + "roll: 2"
				"delta boost" = 4 + "roll: 8"
				"deep boost" = 6 + "roll: 12"
				# The ( ( 10 - x + "race length" ) / 10 ) flips to 1 when race length is x or greater, 0 if it's less than x. Only used to roll for the length of the track.
				"megaparsec speed" = "roll: 12" + "roll: 12" + "roll: 12" + ( ( 10 - 4 + "race length" ) / 10 ) * ( "roll: 12" ) + ( ( 10 - 5 + "race length" ) / 10 ) * "roll: 12"
				"syndicate speed" = "roll: 10" + "roll: 10" + "roll: 10" + ( ( 10 - 4 + "race length" ) / 10 ) * ( "roll: 10" ) + ( ( 10 - 5 + "race length" ) / 10 ) * "roll: 10"
				"delta speed" = "roll: 8" + "roll: 8" + "roll: 8" + ( ( 10 - 4 + "race length" ) / 10 ) * ( "roll: 8" ) + ( ( 10 - 5 + "race length" ) / 10 ) * "roll: 8"
				"deep speed" = "roll: 6" + "roll: 6" + "roll: 6" + ( ( 10 - 4 + "race length" ) / 10 ) * ( "roll: 6" ) + ( ( 10 - 5 + "race length" ) / 10 ) * "roll: 6"
				"syndicate laps" = "syndicate speed" + "syndicate boost"
				"delta laps" = "delta speed" + "delta boost"
				"deep laps" = "deep speed" + "deep boost"
			`	You board <ship> for the quick trip to the <racename>. Out the window, ${sunracer city to wilderness description}. Eventually, you park your ship outside the <racename>, and walk up to the racetrack's entrance.`
			label decisioning
			`<CN-612>`
			`<CN-613>`
			`<CN-307>`
			`<CN-614>`
			`<CN-615>`
			`<CN-616>`
			`<CN-617>`
			`<CN-618>`
			`<CN-307>`
			choice
				`<CN-619>`
					goto race
				`<CN-620>`
					to display
						not "hovercraft racing: talked to fan"
				`<CN-621>`
					to display
						or
							"flagship attribute: outfit scan power" > 0
							"flagship attribute: tactical scan power" > 0
					goto scanner
			action
				set "hovercraft racing: talked to fan"
			`	Near the <racename>'s entrance, you spot a friendly figure ${sunracer fan tshirt}:`
			`<CN-622>`
			`<CN-623>`
			`<CN-624>`
			`<CN-625>`
			`<CN-307>`
				goto decisioning
			label scanner
			`<CN-626>`
			`<CN-307>`
			`<CN-627>`
			`<CN-628>`
			`<CN-629>`
			`<CN-630>`
			`<CN-307>`
				goto decisioning
			label race
			action
				clear "sunracer race winner"
			`	${sunracer hovercraft race description}`
			branch megawon
				and
					"megaparsec speed" >= "syndicate laps"
					"megaparsec speed" >= "delta laps"
					"megaparsec speed" >= "deep laps"
			branch syndwon
				and
					"syndicate laps" >= "delta laps"
					"syndicate laps" >= "deep laps"
			branch deltwon
				"delta laps" >= "deep laps"
			action
				"sunracer race winner" = 4
				# maximum of other laps
				"second place" = "megaparsec speed"
				"second place" >?= "syndicate laps"
				"second place" >?= "delta laps"
				# minimum of other laps
				"last place" = "megaparsec speed"
				"last place" <?= "syndicate laps"
				"last place" <?= "delta laps"
				"second place margin" = "deep laps" - "second place"
			`	Deep Sky Dynamics <deep name> ${sunracer hovercraft victory description}`
				goto ending
			label deltwon
			action
				"sunracer race winner" = 3
				# maximum of other laps
				"second place" = "megaparsec speed"
				"second place" >?= "syndicate laps"
				"second place" >?= "deep laps"
				# minimum of other laps
				"last place" = "megaparsec speed"
				"last place" <?= "syndicate laps"
				"last place" <?= "deep laps"
				"second place margin" = "delta laps" - "second place"
			`	Delta V Grand Prix <delta name> ${sunracer hovercraft victory description}`
				goto ending
			label syndwon
			action
				"sunracer race winner" = 2
				# maximum of other laps
				"second place" = "megaparsec speed"
				"second place" >?= "deep laps"
				"second place" >?= "delta laps"
				# minimum of other laps
				"last place" = "megaparsec speed"
				"last place" <?= "deep laps"
				"last place" <?= "delta laps"
				"second place margin" = "syndicate laps" - "second place"
			`	Syndicate Performance Racing <syndicate name> ${sunracer hovercraft victory description}`
				goto ending
			label megawon
			action
				"sunracer race winner" = 1
				# maximum of other laps
				"second place" = "deep laps"
				"second place" >?= "syndicate laps"
				"second place" >?= "delta laps"
				# minimum of other laps
				"last place" = "deep laps"
				"last place" <?= "syndicate laps"
				"last place" <?= "delta laps"
				"second place margin" = "megaparsec speed" - "second place"
			`	Megaparsec Racing Technologies <megaparsec name> ${sunracer hovercraft victory description}`
			label ending
			action
				"last place margin" = "second place" - "last place"
			branch secondplaceten
				"second place margin" >= 10
			branch secondplacefour
				"second place margin" >= 4
			branch secondplacetwo
				"second place margin" >= 2
			branch secondplaceone
				"second place margin" >= 1
			# 2nd place margin of 0:happens in ~9% of races, 1:~16%, 2-3:~24%,4-9:~38%,10+:~12%
			`<CN-631>`
				goto endingmiddle
			label secondplaceone
			`<CN-632>`
				goto endingmiddle
			label secondplacetwo
			`<CN-633>`
				goto endingmiddle
			label secondplacefour
			`<CN-634>`
				goto endingmiddle
			label secondplaceten
			`<CN-635>`
			label endingmiddle
			branch lastplacefourteen
				"last place margin" >= 14
			branch lastplacenine
				"last place margin" >= 9
			branch lastplacesix
				"last place margin" >= 6
			branch lastplacethree
				"last place margin" >= 3
			# last place margin of 0-2:happens in ~8% of races, 3-5:~27%, 6-8:~28%,9-14:~29%,14+:~8%
			`<CN-636>`
				goto trueending
			label lastplacethree
			`<CN-637>`
				goto trueending
			label lastplacesix
			`<CN-638>`
				goto trueending
			label lastplacenine
			`<CN-639>`
				goto trueending
			label lastplacefourteen
			`<CN-640>`
			label trueending
			`	${sunracer hovercraft victory exit}`
			`<CN-641>`
			`<CN-307>`
			`<CN-642>`
			`<CN-643>`
			`<CN-644>`
			`<CN-645>`
			# The next line can be used when testing changes to the mission, but should remain commented out on the master branch.
			# `	2nd place: &[second place], margin: &[second place margin]; last place: &[last place], margin: &[last place margin]`
			`<CN-307>`
			action
				clear "race length"
				clear "syndicate boost"
				clear "delta boost"
				clear "deep boost"
				clear "megaparsec speed"
				clear "syndicate speed"
				clear "delta speed"
				clear "deep speed"
				clear "syndicate laps"
				clear "delta laps"
				clear "deep laps"
				clear "second place"
				clear "last place"
				clear "second place margin"
				clear "last place margin"
				clear "hovercraft racing: talked to fan"
