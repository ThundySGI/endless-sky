# Copyright (c) 2023 by Azure
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.


mission "Avgi: Lost in Twilight"
	landing
	invisible
	to complete
		never
	on enter
		system
			attributes "twilight"
		log "<LG-272>"
		fail
		set "avgi: lost in twilight"
		dialog phrase "lost in twilight"

phrase "lost in twilight"
	word
		`<WR-9141>`

mission "Avgi: First Contact"
	landing
	autosave
	name "<NM-453>"
	description "<DS-1983>"
	source
		attributes "avgi"
	destination "Peripheria"
	mark "Arche"
	clearance
	on offer
		set "avgi: aberrant siege"
		event "twilight label"
		event "tangled shroud label"
		conversation
			branch aviskir
				has "flagship planet: Aviskir"
			branch "core world"
				has "flagship planet attribute: avgi core"
			branch station
				has "flagship planet attribute: station"
			branch uninhabited
				has "flagship planet attribute: uninhabited"

			label aviskir
			`<CN-7980>`
			`<CN-7981>`
			action
				set "avgi: fired on by planets"
			choice
				`<CN-7982>`
					goto explode
					to display
						"flagship attribute: shields" + "flagship attribute: hull" <= 18000 * 1000
				`<CN-7982>`
					goto hit
					to display
						"flagship attribute: shields" + "flagship attribute: hull" > 18000 * 1000
						"flagship attribute: shields" + "flagship attribute: hull" < 90000 * 1000
				`<CN-7982>`
					goto scratched
					to display
						"flagship attribute: shields" + "flagship attribute: hull" >= 90000 * 1000
				`<CN-7983>`
					goto orbit

			label "core world"
			`<CN-7984>`
			`<CN-7981>`
			action
				set "avgi: fired on by planets"
			choice
				`<CN-7982>`
					goto explode
					to display
						"flagship attribute: shields" + "flagship attribute: hull" <= 9000 * 1000
				`<CN-7982>`
					goto hit
					to display
						"flagship attribute: shields" + "flagship attribute: hull" > 9000 * 1000
						"flagship attribute: shields" + "flagship attribute: hull" < 60000 * 1000
				`<CN-7982>`
					goto scratched
					to display
						"flagship attribute: shields" + "flagship attribute: hull" >= 60000 * 1000
				`<CN-7983>`
					goto orbit

			label explode
			`<CN-7985>`
				explode

			label hit
			`<CN-7986>`
				goto orbit

			label scratched
			`<CN-7987>`
				goto orbit

			label uninhabited
			`<CN-7988>`
				goto orbit

			label orbit
			`<CN-7989>`
			choice
				`<CN-7990>`
					goto talk
				`<CN-7991>`
					goto prime
				`<CN-505>`
					goto silent

			label station
			`<CN-7992>`
			`<CN-7993>`
			choice
				`<CN-7994>`
					goto talk
				`<CN-7991>`
					goto prime
				`<CN-505>`
					goto silent

			label talk
			`<CN-7995>`
			`<CN-7996>`
			`<CN-7997>`
				goto transmission

			label prime
			`<CN-7998>`
			`<CN-7999>`
			`<CN-7997>`
				goto transmission

			label silent
			`<CN-8000>`

			label transmission
			`<CN-8001>`
			`<CN-8002>`
				launch

	npc
		government "Aberrant"
		personality coward secretive vindictive entering
		fleet
			names "aberrant names"
			variant
				"Aberrant Latte" 2
				"Aberrant Whiskers"

	npc
		government "Aberrant"
		personality
			confusion 90
			coward secretive uninterested vindictive
		system "Quintessence"
		fleet
			names "aberrant names"
			variant
				"Aberrant Chomper"

	npc
		government "Aberrant"
		personality
			confusion 90
			coward secretive uninterested vindictive
		system "Ballad"
		fleet
			names "aberrant names"
			variant
				"Aberrant Trip"

	npc
		government "Aberrant"
		personality
			confusion 90
			coward secretive uninterested vindictive
		system "H-1"
		fleet
			names "aberrant names"
			variant
				"Aberrant Hugger" 2

	npc save accompany
		government "Avgi (Twilight Guard)"
		personality escort fleeing launching timid
		ship "Polari" "Distant Shores"

	on accept
		"reputation: Avgi" >?= 5
		"reputation: Avgi (Consonance)" >?= 5
		"reputation: Avgi (Twilight Guard)" >?= 5

	on enter "Arche"
		mark "Ballad"
		unmark "Arche"

	on enter "Ballad"
		unmark "Ballad"

	on enter "Concerto"
		conversation
			`<CN-8003>`
			`<CN-8004>`

	on fail
		dialog `<DL-404>`

	on visit
		dialog `<DL-405>`

	on complete
		"reputation: Avgi" += 10
		"reputation: Avgi (Consonance)" += 10
		"reputation: Avgi (Twilight Guard)" += 10
		set "discovered avgi"
		event "outer limits label"



mission "Avgi: Humans From the Deep"
	landing
	name "<NM-454>"
	description "<DS-1984>"
	source "Peripheria"
	destination "Aktina Cylinder"
	to offer
		has "Avgi: First Contact: done"
	on offer
		log `<LG-273>`
		log "Factions" "Avgi" `<LG-274>`
		log "Factions" "Avgi Consonance" `<LG-275>`
		log "People" "Asime" `<LG-276>`
		log "People" "Galano" `<LG-277>`
		log "People" "Prasinos" `<LG-278>`
		set "avgi: met lait"
		set "language: Avgi"
		conversation
			`<CN-8005>`
			`<CN-8006>`
			`<CN-8007>`
			choice
				`<CN-8008>`
					goto next
				`<CN-8009>`
					goto next
				`<CN-8010>`
					goto next
				`<CN-8011>`

			`<CN-8012>`
				die

			label next
			`<CN-8013>`
			`<CN-8014>`
			choice
				`<CN-8015>`
					goto follow
				`<CN-8016>`
				`<CN-8017>`
				`<CN-8018>`

			`<CN-8019>`

			label follow
			`<CN-8020>`
			`<CN-8021>`
			choice
				`<CN-5569>`
				`<CN-678>`
			`<CN-8022>`
			`<CN-8023>`
			`<CN-8024>`
			choice
				`<CN-8016>`
					goto humans
				`<CN-8017>`
					goto aberrant
				`<CN-8018>`
			label avgi
			action
				set "avgi: asked about avgi"
			`<CN-8025>`
			`<CN-8026>`
			`<CN-8027>`
			`<CN-8028>`
			`<CN-8029>`
			`<CN-8030>`
			choice
				`<CN-8031>`
					goto humans
					to display
						not "avgi: asked about humans"
				`<CN-8032>`
					goto aberrant
					to display
						not "avgi: asked about aberrant"
				`<CN-8033>`
					goto conclusion

			label humans
			action
				set "avgi: asked about humans"
			`<CN-8034>`
			`<CN-8035>`
			label "human questions"
			choice
				`<CN-8036>`
					goto aberrant
					to display
						not "avgi: asked about aberrant"
				`<CN-8037>`
					goto avgi
					to display
						not "avgi: asked about avgi"
				`<CN-8038>`
					goto technology
					to display
						not "avgi: asked about human tech"
				`<CN-8039>`
					goto conclusion

			label technology
			action
				set "avgi: asked about human tech"
			`<CN-8040>`
				goto "human questions"

			label aberrant
			action
				set "avgi: asked about aberrant"
			`<CN-8041>`
			`<CN-8042>`
			`<CN-8043>`
			`<CN-8044>`
			`<CN-8045>`
			choice
				`<CN-8046>`
					goto humans
					to display
						not "avgi: asked about humans"
				`<CN-8037>`
					goto avgi
					to display
						not "avgi: asked about avgi"
				`<CN-8033>`
					goto conclusion

			label conclusion
			`<CN-8047>`
			`<CN-8048>`
			`<CN-8049>`
			choice
				`<CN-8050>`
				`<CN-8051>`

			`<CN-8052>`
			`<CN-8053>`
			choice
				`<CN-8054>`
					goto "buy stuff"
				`<CN-8055>`

			`<CN-8056>`
			label "buy stuff"
			`<CN-8057>`
			`<CN-8058>`
			`<CN-8059>`
			`<CN-8060>`
			`<CN-8061>`
			`<CN-8062>`
				accept
	on accept
		clear "avgi: asked about avgi"
		clear "avgi: asked about humans"
		clear "avgi: asked about aberrant"



mission "Avgi: Defend Ensemble 1"
	landing
	name "<NM-455>"
	description "<DS-1985>"
	source "Aktina Cylinder"
	destination "Navigeo Yards"
	passengers 1
	blocked "<BL-36>"
	to offer
		has "Avgi: Humans From the Deep: done"
	on offer
		log "People" "Darius Caldwell" `<LG-279>`
		conversation
			`<CN-8063>`
			`<CN-8064>`
			choice
				`<CN-8065>`
				`<CN-8066>`
			`<CN-8067>`
			choice
				`<CN-8068>`
				`<CN-8069>`
			`<CN-8070>`
			choice
				`<CN-8071>`
					goto korath
					to display
						"reputation: Korath" < -10
				`<CN-8072>`
					goto pug
					to display
						has "FWC Pug 2D: done"
				`<CN-8073>`
					goto korath
					to display
						has "FW Pug 2B: done"
						not "FW Pug 2C: Jump Drive: done"
				`<CN-8074>`
					goto unfettered
					to display
						has "Wanderers: Translation Machine: done"
				`<CN-8075>`
					goto quarg
					to display
						"reputation: Quarg" < 0
				`<CN-8076>`
			`<CN-8077>`
				goto next

			label korath
			`<CN-8078>`
				goto next

			label pug
			`<CN-8079>`
				goto next

			label unfettered
			`<CN-8080>`
				goto next

			label quarg
			`<CN-8081>`

			label next
			`<CN-8082>`
			`<CN-8083>`
			choice
				`<CN-8084>`
					goto reassuring
				`<CN-8085>`
				`<CN-8086>`
					goto story

			`<CN-8087>`

			label reassuring
			`<CN-8088>`
			choice
				`<CN-8086>`

			label story
			`<CN-8089>`
			`<CN-8090>`
			`<CN-8091>`
			choice
				`<CN-8092>`

			`<CN-8093>`
			choice
				`<CN-8094>`
					goto blame
				`<CN-8095>`
			`<CN-8096>`
				goto end

			label blame
			`<CN-8097>`

			label end
			`<CN-8098>`
			`<CN-8099>`
				accept
	on visit
		dialog `<DL-406>`


mission "Avgi: Defend Ensemble 2"
	autosave
	landing
	name "<NM-456>"
	description "<DS-1986>"
	source "Navigeo Yards"
	destination "Weledos"
	passengers 1
	blocked "<BL-37>"
	to offer
		has "Avgi: Defend Ensemble 1: done"
	on offer
		log `<LG-280>`
		log "Factions" "Twilight Guard" `<LG-281>`
		log "Factions" "Avgi" `<LG-282>`
		conversation
			`<CN-8100>`
			`<CN-8101>`
			`<CN-8102>`
			choice
				`<CN-8103>`
					goto end
				`<CN-8104>`

			`<CN-8105>`
			choice
				`<CN-8106>`
					goto end
				`<CN-8107>`

			`<CN-8108>`

			label end
			`<CN-8109>`
				accept
	npc
		government "Avgi (Twilight Guard)"
		personality heroic frugal escort
		fleet
			names "avgi military names"
			variant
				"Prismaios"
				"Prismaios (Orchid)" 2
				"Tremoros" 3
	npc
		government "Avgi (Twilight Guard)"
		personality heroic frugal waiting escort
		fleet
			names "avgi military names"
			variant
				"Difraktos (Orchid)"
				"Refraktos"
				"Atenuatia (Orchid)"
				"Vibratia" 20
				"Photikon (Ophrys)" 6
	npc
		government "Avgi (Twilight Guard)"
		personality heroic staying waiting
		system "Ensemble"
		fleet
			names "avgi military names"
			variant
				"Prismaios"
				"Tremoros" 3
				"Refraktos"
				"Diaspersi"
				"Vibratia" 6
				"Photikon" 2
	npc
		government "Avgi (Twilight Guard)"
		personality heroic waiting
		system "Arche"
		fleet
			names "avgi military names"
			variant
				"Prismaios" 3
				"Tremoros" 6
				"Refraktos" 2
	npc evade
		government "Aberrant"
		personality
			confusion 40
			coward hunting secretive staying vindictive target
		system "Ensemble"
		fleet
			names "aberrant names"
			variant
				"Aberrant Latte" 2
				"Aberrant Chomper (Disable-able)" 2
				"Aberrant Pileup"
		fleet
			names "aberrant names"
			variant
				"Aberrant Latte" 2
				"Aberrant Chomper"
				"Aberrant Whiskers" 2
		fleet
			names "aberrant names"
			variant
				"Aberrant Latte"
				"Aberrant Chomper" 2
				"Aberrant Whiskers"
		fleet
			names "aberrant names"
			variant
				"Aberrant Icebreaker"
				"Aberrant Mole" 2
		fleet
			names "aberrant names"
			variant
				"Aberrant Icebreaker" 2
				"Aberrant Mole"
		fleet
			names "aberrant names"
			variant
				"Aberrant Trip"
				"Aberrant Triplet (Disable-able)" 3
	on visit
		dialog `<DL-407>`

	on complete
		log `<LG-283>`
		log "People" "Sora Kun" `<LG-284>`
		log "People" "Darius Caldwell" `<LG-285>`
		log "People" "Kokkino" `<LG-286>`
		conversation
			`<CN-8110>`
			`<CN-8111>`
			choice
				`<CN-8112>`
					goto handshake
				`<CN-678>`
			`<CN-8113>`
				goto name
			label handshake
			`<CN-8114>`
			label name
			`<CN-8115>`
			`<CN-8116>`
			`<CN-8117>`
			`<CN-8118>`
			`<CN-8119>`
			choice
				`<CN-8120>`
				`<CN-8121>`
				`<CN-8122>`
			`<CN-8123>`
			choice
				`<CN-133>`
					goto yes
				`<CN-8124>`
			`<CN-8125>`
			label yes
			`<CN-8126>`
			`<CN-8127>`
			`<CN-8128>`
			choice
				`<CN-8129>`
					goto warship
				`<CN-8130>`
			action
				set "avgi: rescue intro"
			`<CN-8131>`
			choice
				`<CN-6219>`
				`<CN-8132>`
			`<CN-8133>`
				goto end

			label warship
			action
				set "avgi: warship intro"
			`<CN-8134>`
			choice
				`<CN-6219>`
				`<CN-8132>`
			`<CN-8135>`

			label end
			`<CN-8136>`
			choice
				`<CN-8137>`
				`<CN-8138>`
			`<CN-8139>`
			choice
				`<CN-8140>`
				`<CN-8141>`
			`<CN-8142>`
			`<CN-8143>`
			`<CN-8144>`


mission "Avgi: Scout Rescue"
	name "<NM-457>"
	description "<DS-1987>"
	source "Weledos"
	destination "Peripheria"
	mark "Twirl"
	passengers 12
	blocked "<BL-38>"
	to offer
		has "Avgi: Defend Ensemble 2: done"
	to fail
		has "avgi: warship intro"
	on offer
		conversation
			`<CN-8145>`
			`<CN-8146>`
			choice
				`<CN-8147>`
					goto exploration
				`<CN-8148>`
			`<CN-8149>`
				goto point
			label exploration
			`<CN-8150>`
			label point
			`<CN-8151>`
			choice
				`<CN-238>`
				`<CN-8152>`
			`<CN-8153>`
				accept
	on accept
		log `<LG-287>`

	on enter "Twirl"
		unmark "Twirl"
		dialog `<DL-408>`

	npc assist
		government "Avgi (Twilight Guard)"
		personality derelict mute pacifist target
		system Whirlwind
		ship "Polari" "Silver Albedo"
		conversation
			`<CN-8154>`
			`<CN-8155>`
			choice
				`<CN-8156>`
					goto serious
				`<CN-8157>`
			`<CN-8158>`
				goto next
			label serious
			`<CN-8159>`
			label next
			`<CN-8160>`
				depart

	on complete
		conversation
			`<CN-8161>`
			`<CN-8162>`
			`<CN-8163>`
			`<CN-8164>`
			`<CN-8165>`
	on visit
		dialog `<DL-409>`


mission "Avgi: Frontline Combat"
	name "<NM-458>"
	description "<DS-1988>"
	source "Weledos"
	destination "Feo Platform"
	waypoint "Corporeal"
	waypoint "Empyrean"
	waypoint "Firmament"
	waypoint "Lumine"
	to offer
		has "Avgi: Defend Ensemble 2: done"
	to fail
		has "avgi: rescue intro"
	on offer
		conversation
			`<CN-8145>`
			`<CN-8166>`
			`<CN-8167>`
			choice
				`<CN-8168>`
				`<CN-7533>`
			`<CN-8169>`
			`<CN-8170>`
				accept
	on accept
		log `<LG-288>`
	on visit
		dialog `<DL-410>`

	npc kill
		government "Aberrant"
		personality
			confusion 40
			coward secretive staying target uninterested vindictive
		system "Corporeal"
		fleet
			names "aberrant names"
			variant
				"Aberrant Junior"
				"Aberrant Icebreaker"
	npc kill
		government "Aberrant"
		personality
			confusion 40
			coward secretive staying target uninterested vindictive
		system "Empyrean"
		fleet
			names "aberrant names"
			variant
				"Aberrant Hugger"
				"Aberrant Pileup"
	npc kill
		government "Aberrant"
		personality
			confusion 40
			coward secretive staying target uninterested vindictive
		system "Firmament"
		fleet
			names "aberrant names"
			variant
				"Aberrant Triplet"
	npc kill
		government "Aberrant"
		personality
			confusion 40
			coward secretive staying target uninterested vindictive
		system "Lumine"
		fleet
			names "aberrant names"
			variant
				"Aberrant Chomper" 2



mission "Avgi: Dissonance Outreach 0.5"
	landing
	name "<NM-459>"
	description "<DS-1989>"
	source "Feo Platform"
	destination "Peripheria"
	passengers 2
	blocked "<BL-39>"
	to offer
		has "Avgi: Frontline Combat: done"
	on offer
		conversation
			`<CN-8171>`
			`<CN-8163>`
			`<CN-8164>`
			`<CN-8172>`
				accept
	on complete
		dialog
			`<CN-8173>`
	on visit
		dialog `<DL-411>`


mission "Avgi: Dissonance Outreach"
	name "<NM-460>"
	description "<DS-1990>"
	source "Peripheria"
	destination "Outpost Tekis"
	passengers 3
	blocked "<BL-40>"
	clearance "Hriso has an animated argument with the spaceport controller, saying something about access rights, and manages to get you reluctant permission to dock."
	to offer
		or
			has "Avgi: Scout Rescue: done"
			has "Avgi: Frontline Combat: done"
	on offer
		log "People" "Hriso" `<LG-289>`
		log "People" "Sora Kun" `<LG-290>`
		log "Factions" "Avgi Consonance" `<LG-291>`
		log "Factions" "Avgi Dissonance" `<LG-292>`
		conversation
			`<CN-8174>`
			choice
				`<CN-8175>`
				`<CN-8176>`
					goto dissonance
			`<CN-8177>`

			label dissonance
			`<CN-8178>`
			`<CN-8179>`
			`<CN-8180>`
			`<CN-8181>`
				accept

	on accept
		log `<LG-293>`


mission "Avgi: Twilight Escape 1"
	landing
	name "<NM-461>"
	description "<DS-1991>"
	source "Outpost Tekis"
	destination "Vinci"
	passengers 3
	blocked "<BL-41>"
	to offer
		has "Avgi: Dissonance Outreach: done"
	on offer
		log `<LG-294>`
		log "Factions" "Avgi Dissonance" `<LG-295>`
		log "People" "Leon Shez" `<LG-296>`
		conversation
			`<CN-8182>`
			`<CN-8183>`
			`<CN-8184>`
			choice
				`<CN-8185>`
				`<CN-505>`

			`<CN-8186>`
			`<CN-8187>`
			`<CN-8188>`
			`<CN-8189>`
			`<CN-8190>`
			`<CN-8191>`
			`<CN-8192>`
			`<CN-8193>`
			`<CN-8194>`
			choice
				`<CN-8195>`
					goto you
				`<CN-8196>`

			`<CN-8197>`
			label you
			`<CN-8198>`
			choice
				`<CN-8199>`
				`<CN-8200>`

			`<CN-8201>`
			`<CN-8202>`
			choice
				`<CN-2514>`
					goto agreed
				`<CN-1665>`
			`<CN-8203>`

			label agreed
			`<CN-8204>`
			`<CN-8205>`
			choice
				`<CN-8206>`
				`<CN-8207>`

			`<CN-8208>`
			`<CN-8209>`
			`<CN-8210>`
			branch "unknown ember waste"
				not "event: ember waste label"
			choice
				`<CN-8211>`
			`<CN-8212>`

			label "unknown ember waste"
			`<CN-8213>`
				accept
	on enter "Decet"
		log `<LG-297>`
		conversation
			`<CN-8214>`
	on enter
		system
			attributes "core" "deep" "dirt belt" "near earth" "rim" "south"
		conversation
			`<CN-8215>`
			choice
				`<CN-8216>`
				`<CN-8217>`

			`<CN-8218>`
			`<CN-8219>`
			`<CN-8220>`
			`<CN-8221>`
	on complete
		log `<LG-298>`
		log "People" "Leon Shez" `<LG-299>`
		clear "avgi: lost in twilight"
		"reputation: Avgi (Dissonance Angry)" <?= -10
		conversation
			`<CN-8222>`
			`<CN-8223>`
			`<CN-8224>`
			choice
				`<CN-4623>`
				`<CN-4580>`

			`<CN-8225>`
			`<CN-8226>`
	on visit
		dialog `<DL-412>`


mission "Avgi: Twilight Escape 2"
	name "<NM-462>"
	description "<DS-1992>"
	source "Vinci"
	destination "Memory"
	passengers 2
	blocked "<BL-42>"
	to offer
		has "Avgi: Twilight Escape 1: done"
	on offer
		conversation
			`<CN-8227>`
			`<CN-8228>`
			`<CN-8229>`
			`<CN-8230>`
			`<CN-8231>`
			`<CN-8232>`
			`<CN-8233>`
			`<CN-8234>`
			`<CN-4015>`
				accept

	on accept
		log `<LG-300>`
		log "People" "Darius Caldwell" `<LG-301>`
	on visit
		dialog `<DL-411>`


mission "Avgi: Twilight Escape 3"
	landing
	name "<NM-463>"
	description "<DS-1993>"
	source "Memory"
	destination "Valhalla"
	passengers 1
	blocked "<BL-43>"
	to offer
		has "Avgi: Twilight Escape 2: done"
	on offer
		log "People" "Darius Caldwell" `<LG-302>`
		conversation
			`<CN-8235>`
			`<CN-8236>`
			`<CN-8237>`
			`<CN-8238>`
			choice
				`<CN-8239>`
				`<CN-8240>`
			`<CN-8241>`
			choice
				`<CN-8242>`
				`<CN-8243>`
					goto optimism
			`<CN-8244>`
			label optimism
			`<CN-8245>`
				accept

	on accept
		log `<LG-303>`

	on complete
		log `<LG-304>`
		log "Minor People" "Katrina Caldwell" `<LG-305>`
		conversation
			`<CN-8246>`
			`<CN-8247>`
			`<CN-8248>`
			`<CN-8249>`
			`<CN-8250>`
			choice
				`<CN-8251>`
				`<CN-8252>`
					goto lookup
			`<CN-8253>`
			`<CN-8254>`
			label lookup
			`<CN-8255>`
			`<CN-8256>`
			`<CN-8257>`
			`<CN-8258>`
			`<CN-8259>`
			`<CN-8260>`
			`<CN-8261>`
			`<CN-8262>`
			choice
				`<CN-8263>`
				`<CN-8264>`
				`<CN-8265>`
			`<CN-8266>`
			`<CN-8267>`
			`<CN-8268>`
	on visit
		dialog `<DL-406>`
